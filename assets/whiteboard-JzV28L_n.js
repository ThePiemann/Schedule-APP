import{o as G,b as K}from"./auth-cbFyKSDW.js";import{setCurrentUser as Q,loadUserData as V,userData as f,saveUserData as U}from"./store-B-09Ib52.js";let u,k,y,r,b=!1,x="pen",W="#000000",D=3,g=[],v=[];const I=1440*60*1e3;document.addEventListener("DOMContentLoaded",()=>{G(K,e=>{e?(Q(e),V(()=>{Z(e)})):window.location.href="/pages/login/"}),ie()});function Z(e){ae(e),ee(),ne(),oe(),window.addEventListener("resize",()=>{const t=u.toDataURL();$(),_(t)})}function ee(){document.getElementById("canvasContainer"),u=document.getElementById("whiteboardCanvas"),k=u.getContext("2d",{willReadFrequently:!0}),y=document.getElementById("tempCanvas"),r=y.getContext("2d"),$(),u.addEventListener("mousedown",te),window.addEventListener("mousemove",X),window.addEventListener("mouseup",F),u.addEventListener("touchstart",e=>{e.target===u&&e.preventDefault();const t=e.touches[0],n=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});u.dispatchEvent(n)},{passive:!1}),window.addEventListener("touchmove",e=>{if(!b)return;const t=e.touches[0],n=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});X(n)},{passive:!1}),window.addEventListener("touchend",e=>{new MouseEvent("mouseup",{}),F()})}function $(){const e=document.getElementById("canvasContainer");u.width=e.clientWidth,u.height=e.clientHeight,y.width=e.clientWidth,y.height=e.clientHeight,[k,r].forEach(t=>{t.lineCap="round",t.lineJoin="round"})}function te(e){if(e.target!==u)return;b=!0;const[t,n]=A(e);g=[[t,n]],document.getElementById("whiteboardPlaceholder").style.opacity="0",H()}function X(e){if(!b)return;const[t,n]=A(e);g.push([t,n]),H()}function H(){if(r.clearRect(0,0,y.width,y.height),g.length<2)return;r.beginPath(),r.moveTo(g[0][0],g[0][1]);for(let t=1;t<g.length-1;t++){const n=g[t],l=g[t+1],i=[(n[0]+l[0])/2,(n[1]+l[1])/2];r.quadraticCurveTo(n[0],n[1],i[0],i[1])}const e=g[g.length-1];r.lineTo(e[0],e[1]),x==="eraser"?(r.globalAlpha=1,r.strokeStyle=document.documentElement.classList.contains("dark")?"#1C1C1E":"#FFFFFF",r.lineWidth=D*5):(r.strokeStyle=W,x==="highlighter"?(r.globalAlpha=.4,r.lineWidth=D*3,r.lineCap="round"):(r.globalAlpha=1,r.lineWidth=D,r.lineCap="round")),r.stroke()}function F(){b&&(b=!1,g.length>0&&k.drawImage(y,0,0),r.clearRect(0,0,y.width,y.height),g=[],E())}function A(e){const t=u.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top]}function ne(){const e=document.getElementById("toolPen"),t=document.getElementById("toolHighlighter"),n=document.getElementById("toolEraser"),l=document.getElementById("addStickyBtn"),i=document.getElementById("colorPicker"),d=document.getElementById("lineWidth"),c=document.getElementById("clearBoardBtn");document.getElementById("exportDropdownBtn"),document.getElementById("exportDropdown"),document.getElementById("downloadImageBtn"),document.getElementById("downloadPdfBtn");const o=document.getElementById("whiteboardToolbar");let a=!1,m=0,h=0;const C=10;function P(s){if(s.target.tagName==="BUTTON"||s.target.tagName==="INPUT"||s.target.closest("button"))return;a=!0;const p=s.touches?s.touches[0].clientX:s.clientX,M=s.touches?s.touches[0].clientY:s.clientY,w=o.getBoundingClientRect(),B=o.offsetParent.getBoundingClientRect();m=p-w.left,h=M-w.top,o.style.transform="none",o.style.left=`${w.left-B.left}px`,o.style.top=`${w.top-B.top}px`,o.style.cursor="grabbing"}function R(s){if(!a)return;s.preventDefault();const p=s.touches?s.touches[0].clientX:s.clientX,M=s.touches?s.touches[0].clientY:s.clientY,w=o.offsetParent.getBoundingClientRect();let B=p-m-w.left,T=M-h-w.top;const J=o.offsetParent.clientWidth-o.offsetWidth-C,j=o.offsetParent.clientHeight-o.offsetHeight-C;B=Math.max(C,Math.min(B,J)),T=Math.max(C,Math.min(T,j)),o.style.left=`${B}px`,o.style.top=`${T}px`}function N(){a=!1,o.style.cursor="move"}o.addEventListener("mousedown",P),document.addEventListener("mousemove",R),document.addEventListener("mouseup",N),o.addEventListener("touchstart",P,{passive:!1}),document.addEventListener("touchmove",R,{passive:!1}),document.addEventListener("touchend",N);const L=document.getElementById("clearModal"),q=document.getElementById("cancelClearBtn"),z=document.getElementById("confirmClearBtn");function S(s){[e,t,n].forEach(p=>{p===s?(p.classList.add("active","bg-primary/10","text-primary"),p.classList.remove("text-gray-600","dark:text-gray-300")):(p.classList.remove("active","bg-primary/10","text-primary"),p.classList.add("text-gray-600","dark:text-gray-300"))})}e.addEventListener("click",()=>{x="pen",S(e)}),t.addEventListener("click",()=>{x="highlighter",S(t)}),n.addEventListener("click",()=>{x="eraser",S(n)}),l.addEventListener("click",()=>{const s={id:Date.now(),x:100+v.length*20,y:150+v.length*20,text:"",color:"#FEF3C7"};v.push(s),O(s),E()}),i.addEventListener("change",s=>{W=s.target.value,x==="eraser"&&e.click()}),d.addEventListener("input",s=>{D=s.target.value}),c.addEventListener("click",()=>{L.classList.remove("hidden"),L.classList.add("flex")}),q.addEventListener("click",()=>{L.classList.add("hidden"),L.classList.remove("flex")}),z.addEventListener("click",()=>{k.clearRect(0,0,u.width,u.height),document.getElementById("notesContainer").innerHTML="",v=[],localStorage.removeItem("studentDash_whiteboard"),E(!0),document.getElementById("whiteboardPlaceholder").style.opacity="0.5",L.classList.add("hidden"),L.classList.remove("flex")})}function O(e){const t=document.getElementById("notesContainer"),n=document.createElement("div");n.className="absolute pointer-events-auto w-48 min-h-[12rem] p-4 shadow-xl rounded-lg flex flex-col group animate-pop-in border border-black/5",n.style.left=`${e.x}px`,n.style.top=`${e.y}px`,n.style.backgroundColor=e.color,n.dataset.id=e.id,n.innerHTML=`
        <div class="note-handle cursor-move h-4 w-full mb-2 flex justify-between items-start opacity-0 group-hover:opacity-100 transition-opacity">
            <div class="flex gap-1">
                <div class="w-3 h-3 rounded-full bg-black/10 hover:bg-red-400 cursor-pointer delete-note"></div>
                <div class="w-3 h-3 rounded-full bg-black/10 hover:bg-blue-400 cursor-pointer color-note" data-color="#DBEAFE"></div>
                <div class="w-3 h-3 rounded-full bg-black/10 hover:bg-green-400 cursor-pointer color-note" data-color="#DCFCE7"></div>
                <div class="w-3 h-3 rounded-full bg-black/10 hover:bg-yellow-400 cursor-pointer color-note" data-color="#FEF3C7"></div>
            </div>
            <span class="material-symbols-outlined text-[10px] text-black/20">drag_indicator</span>
        </div>
        <div class="note-content flex-1 text-sm font-medium text-gray-800 outline-none overflow-hidden break-words" contenteditable="true" placeholder="Type here...">
            ${e.text||""}
        </div>
    `;const l=n.querySelector(".note-handle");let i=!1,d=[0,0];l.addEventListener("mousedown",o=>{i=!0;const a=n.getBoundingClientRect();d=[o.clientX-a.left,o.clientY-a.top],n.style.zIndex=100}),l.addEventListener("touchstart",o=>{i=!0;const a=n.getBoundingClientRect();d=[o.touches[0].clientX-a.left,o.touches[0].clientY-a.top],n.style.zIndex=100}),window.addEventListener("mousemove",o=>{if(!i)return;const a=t.getBoundingClientRect();let m=o.clientX-a.left-d[0],h=o.clientY-a.top-d[1];m=Math.max(0,Math.min(m,t.clientWidth-n.offsetWidth)),h=Math.max(0,Math.min(h,t.clientHeight-n.offsetHeight)),n.style.left=`${m}px`,n.style.top=`${h}px`,e.x=m,e.y=h}),window.addEventListener("touchmove",o=>{if(!i)return;const a=t.getBoundingClientRect();let m=o.touches[0].clientX-a.left-d[0],h=o.touches[0].clientY-a.top-d[1];m=Math.max(0,Math.min(m,t.clientWidth-n.offsetWidth)),h=Math.max(0,Math.min(h,t.clientHeight-n.offsetHeight)),n.style.left=`${m}px`,n.style.top=`${h}px`,e.x=m,e.y=h}),window.addEventListener("mouseup",()=>{i&&(i=!1,n.style.zIndex=20,E())}),window.addEventListener("touchend",()=>{i&&(i=!1,n.style.zIndex=20,E())});const c=n.querySelector(".note-content");c.addEventListener("focus",()=>{saveState()}),c.addEventListener("input",()=>{e.text=c.innerHTML,clearTimeout(c.timeout),c.timeout=setTimeout(E,1e3)}),n.querySelector(".delete-note").addEventListener("click",()=>{n.remove(),v=v.filter(o=>o.id!==e.id),E()}),n.querySelectorAll(".color-note").forEach(o=>{o.addEventListener("click",()=>{const a=o.dataset.color;n.style.backgroundColor=a,e.color=a,E()})}),t.appendChild(n)}function oe(){const e=Date.now();let t=null;const n=localStorage.getItem("studentDash_whiteboard");if(n)try{const l=JSON.parse(n);e-l.timestamp<I?t=l:localStorage.removeItem("studentDash_whiteboard")}catch{}if(!t&&f.whiteboard&&f.whiteboard.timestamp&&(e-f.whiteboard.timestamp<I?t=f.whiteboard:(f.whiteboard=null,U())),t){t.dataUrl&&(_(t.dataUrl),document.getElementById("whiteboardPlaceholder").style.opacity="0"),t.notes&&(v=t.notes,v.forEach(i=>O(i))),f.whiteboard||(f.whiteboard=t);const l=t.timestamp;Y(I-(e-l)),setInterval(()=>{const i=I-(Date.now()-l);i<=0?(localStorage.removeItem("studentDash_whiteboard"),window.location.reload()):Y(i)},6e4)}}function Y(e){const t=document.getElementById("expirationText");if(!t)return;if(e<=0){t.innerText="Expired";return}const n=Math.floor(e/(1e3*60*60)),l=Math.floor(e%(1e3*60*60)/(1e3*60));t.innerText=`${n}h ${l}m Left`}function _(e){const t=new Image;t.onload=()=>k.drawImage(t,0,0),t.src=e}function E(e=!1){const t=Date.now();let n=e?null:u.toDataURL(),l=e?[]:v,i=f.whiteboard?.timestamp;if(!i){const c=localStorage.getItem("studentDash_whiteboard");if(c)try{i=JSON.parse(c).timestamp}catch{}}(!i||t-i>I||e)&&(i=t);const d={dataUrl:n,notes:l,timestamp:i};e?localStorage.removeItem("studentDash_whiteboard"):localStorage.setItem("studentDash_whiteboard",JSON.stringify(d)),f.whiteboard=e?null:d,U()}function ie(){const e=document.getElementById("hamburgerBtn"),t=document.getElementById("appSidebar"),n=document.getElementById("sidebarOverlay"),l=document.getElementById("closeSidebarBtn");function i(a){!t||!n||(a?(t.classList.remove("-translate-x-full"),n.classList.remove("hidden"),setTimeout(()=>n.classList.remove("opacity-0"),10)):(t.classList.add("-translate-x-full"),n.classList.add("opacity-0"),setTimeout(()=>n.classList.add("hidden"),300)))}e&&e.addEventListener("click",a=>{a.stopPropagation(),i(!0)}),l&&l.addEventListener("click",()=>i(!1)),n&&n.addEventListener("click",()=>i(!1));const d=document.getElementById("profileDropdownBtn"),c=document.getElementById("profileDropdownMenu"),o=document.getElementById("closeDropdownBtn");d&&c&&(d.addEventListener("click",a=>{a.stopPropagation(),c.classList.toggle("hidden")}),document.addEventListener("click",a=>{!d.contains(a.target)&&!c.contains(a.target)&&c.classList.add("hidden")})),o&&c&&o.addEventListener("click",()=>c.classList.add("hidden"))}function ae(e){const t=document.getElementById("menuUserName"),n=document.getElementById("menuUserEmail"),l=document.getElementById("navProfileImg"),i=document.getElementById("navProfileIcon"),d=document.getElementById("menuProfileImg"),c=document.getElementById("menuProfileIcon");n&&(n.innerText=e.email);const o=f.settings||{};t&&(t.innerText=o.userFirstName?o.userFirstName:e.displayName?e.displayName.split(" ")[0]:"Student");const a=o.userProfileImage;a&&(l&&(l.src=a,l.classList.remove("hidden")),i&&i.classList.add("hidden"),d&&(d.src=a,d.classList.remove("hidden")),c&&c.classList.add("hidden"))}
