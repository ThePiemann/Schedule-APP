import{o as $,b as P,l as N}from"./auth-cbFyKSDW.js";import{setCurrentUser as C,loadUserData as A,userData as u,saveUserData as x}from"./store-B1XsjTCK.js";let v=null,m=1500,p="pomodoro",I=[],h=new Date().getDay()===0?6:new Date().getDay()-1,f=null;document.addEventListener("DOMContentLoaded",()=>{$(P,e=>{e?(C(e),A(()=>{U(e)})):window.location.href="/pages/login/"}),J(),H(),G(),F(),O(),window.addEventListener("settingsChanged",()=>{v||T()}),M(),setInterval(M,1e3)});function U(e){Q(e),u.studyPlanner||(u.studyPlanner={goals:[],notes:""}),I=u.studyPlanner.goals||[],document.getElementById("studyQuickNotes").value=u.studyPlanner.notes||"",S(),b()}function b(){const e=document.getElementById("studyDailyOverview");if(!e)return;e.innerHTML="";const n=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];document.querySelectorAll(".day-filter-btn").forEach(t=>{parseInt(t.dataset.day)===h?(t.classList.add("bg-primary","text-white"),t.classList.remove("text-gray-500","hover:bg-gray-100","dark:hover:bg-gray-800")):(t.classList.remove("bg-primary","text-white"),t.classList.add("text-gray-500","hover:bg-gray-100","dark:hover:bg-gray-800"))});let s=[];for(let t=0;t<=23;t++){const o=u.studySchedule[`study-schedule-${h}-${t}`];if(o)try{const d=typeof o=="string"?JSON.parse(o):o;s.push({h:t,data:d})}catch(d){console.error("Parse error study session:",d)}}s.length>0?s.forEach(t=>{const o=document.createElement("div");o.className="flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-100 dark:border-gray-700/50 transition hover:shadow-sm animate-pop-in group relative overflow-hidden",o.innerHTML=`
                <div class="absolute left-0 top-0 bottom-0 w-1.5" style="background-color: ${t.data.color||"#4A90E2"}"></div>
                <div class="flex-1 py-1 pl-1">
                    <p class="text-sm font-bold text-gray-800 dark:text-gray-200 leading-tight">${t.data.subject}</p>
                    <p class="text-[10px] text-gray-500 font-medium mt-1">${t.data.start} - ${t.data.end}</p>
                </div>
                <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button class="edit-study-session text-gray-400 hover:text-primary transition p-1" data-hour="${t.h}" data-day="${h}">
                        <span class="material-symbols-outlined text-base">edit</span>
                    </button>
                    <button class="delete-study-session text-gray-400 hover:text-red-500 transition p-1" data-hour="${t.h}" data-day="${h}">
                        <span class="material-symbols-outlined text-base">delete</span>
                    </button>
                </div>
            `,e.appendChild(o)}):e.innerHTML=`
            <div class="text-center py-8 opacity-50 bg-gray-50 dark:bg-gray-800/30 rounded-2xl border-2 border-dashed border-gray-200 dark:border-gray-700">
                <span class="material-symbols-outlined text-3xl mb-2 text-gray-400">event_busy</span>
                <p class="text-xs font-bold">No sessions for ${n[h]}.</p>
            </div>`,e.querySelectorAll(".delete-study-session").forEach(t=>{t.addEventListener("click",o=>{o.stopPropagation();const d=t.dataset.hour,a=t.dataset.day;delete u.studySchedule[`study-schedule-${a}-${d}`],x(),b()})}),e.querySelectorAll(".edit-study-session").forEach(t=>{t.addEventListener("click",o=>{o.stopPropagation();const d=t.dataset.hour,a=t.dataset.day,r=`study-schedule-${a}-${d}`,l=u.studySchedule[r];if(l){const y=typeof l=="string"?JSON.parse(l):l;q(y,r,a)}})})}function q(e,n,s){f=n;const t=document.getElementById("eventModal");document.getElementById("eventInput").value=e.subject,document.getElementById("eventDayInput").value=s,document.getElementById("startTimeInput").value=e.start,document.getElementById("endTimeInput").value=e.end,document.getElementById("selectedColorInput").value=e.color,document.querySelectorAll(".color-btn").forEach(d=>{d.classList.remove("ring-offset-2","ring-gray-400","scale-110"),d.classList.add("ring-transparent"),d.dataset.color===e.color&&(d.classList.remove("ring-transparent"),d.classList.add("ring-offset-2","ring-gray-400","scale-110"))});const o=t.querySelector("h3");o&&(o.innerText="Edit Study Session"),t.classList.remove("hidden"),t.classList.add("flex")}function O(){document.querySelectorAll(".day-filter-btn").forEach(e=>{e.addEventListener("click",()=>{h=parseInt(e.dataset.day),b()})})}function L(){u.studyPlanner={goals:I,notes:document.getElementById("studyQuickNotes").value},x()}function M(){const e=document.getElementById("datetimeDisplay");e&&(e.innerText=new Date().toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}function H(){const e=document.getElementById("startTimerBtn"),n=document.getElementById("pauseTimerBtn"),s=document.getElementById("resetTimerBtn"),t=document.getElementById("pomodoroMode"),o=document.getElementById("shortBreakMode"),d=document.getElementById("longBreakMode"),a=document.getElementById("customMode");e.addEventListener("click",()=>{j(),e.classList.add("hidden"),n.classList.remove("hidden")}),n.addEventListener("click",()=>{k(),n.classList.add("hidden"),e.classList.remove("hidden")}),s.addEventListener("click",()=>{T(),n.classList.add("hidden"),e.classList.remove("hidden")}),t.addEventListener("click",()=>B("pomodoro")),o.addEventListener("click",()=>B("short")),d.addEventListener("click",()=>B("long")),a&&a.addEventListener("click",()=>{const r=document.getElementById("customTimerModal");r&&(r.classList.remove("hidden"),r.classList.add("flex"))}),document.getElementById("closeCustomTimerBtn")?.addEventListener("click",()=>{const r=document.getElementById("customTimerModal");r.classList.add("hidden"),r.classList.remove("flex")}),document.getElementById("applyCustomTimerBtn")?.addEventListener("click",()=>{const r=document.getElementById("customHoursInput"),l=document.getElementById("customMinutesInput"),y=document.getElementById("customSecondsInput"),i=parseInt(r.value)||0,g=parseInt(l.value)||0,c=parseInt(y.value)||0,E=i*3600+g*60+c;if(E>0){B("custom",E);const D=document.getElementById("customTimerModal");D.classList.add("hidden"),D.classList.remove("flex")}})}function B(e,n=null){p=e,k();const s={pomodoro:"pomodoroMode",short:"shortBreakMode",long:"longBreakMode",custom:"customMode"};Object.values(s).forEach(o=>{const d=document.getElementById(o);d&&(d.classList.remove("bg-white","dark:bg-gray-700","shadow-sm"),d.classList.add("text-gray-500"))});const t=document.getElementById(s[e]);if(t&&(t.classList.add("bg-white","dark:bg-gray-700","shadow-sm"),t.classList.remove("text-gray-500")),e==="custom"&&n!==null)m=n,u.studyPlanner.lastCustomSeconds=n;else{const o=u.settings||{};e==="pomodoro"?m=(parseInt(o.pomoDuration)||25)*60:e==="short"?m=(parseInt(o.shortDuration)||5)*60:e==="long"&&(m=(parseInt(o.longDuration)||15)*60)}w(),document.getElementById("startTimerBtn").classList.remove("hidden"),document.getElementById("pauseTimerBtn").classList.add("hidden")}function j(){v||(v=setInterval(()=>{if(m--,w(),m<=0){clearInterval(v),v=null,document.getElementById("startTimerBtn").classList.remove("hidden"),document.getElementById("pauseTimerBtn").classList.add("hidden");try{new Audio("https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg").play()}catch{}const e=document.getElementById("timesUpModal");e&&(e.classList.remove("hidden"),e.classList.add("flex")),T()}},1e3))}document.getElementById("closeTimesUpBtn")?.addEventListener("click",()=>{const e=document.getElementById("timesUpModal");e.classList.add("hidden"),e.classList.remove("flex")});function k(){clearInterval(v),v=null}function T(){k();const e=u.settings||{};p==="custom"?m=u.studyPlanner.lastCustomSeconds||1500:p==="pomodoro"?m=(parseInt(e.pomoDuration)||25)*60:p==="short"?m=(parseInt(e.shortDuration)||5)*60:p==="long"&&(m=(parseInt(e.longDuration)||15)*60),w()}function w(){const e=Math.floor(m/3600),n=Math.floor(m%3600/60),s=m%60;let t;e>0?t=`${e}:${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:t=`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`,document.getElementById("timerDisplay").innerText=t;const o=document.getElementById("timerProgress"),d=u.settings||{};let a;p==="custom"?a=u.studyPlanner.lastCustomSeconds||1500:a=p==="pomodoro"?(parseInt(d.pomoDuration)||25)*60:p==="short"?(parseInt(d.shortDuration)||5)*60:(parseInt(d.longDuration)||15)*60;const r=Math.max(0,m/a),l=2*Math.PI*88;o.style.strokeDashoffset=l*(1-r)}function G(){const e=document.getElementById("addStudyGoalBtn"),n=document.getElementById("studyGoalInput"),s=document.getElementById("studyQuickNotes");e.addEventListener("click",()=>{const t=n.value.trim();t&&(I.push({id:Date.now(),text:t,completed:!1}),n.value="",S(),L())}),n.addEventListener("keypress",t=>{t.key==="Enter"&&e.click()}),s.addEventListener("input",()=>{clearTimeout(s.timeout),s.timeout=setTimeout(L,1e3)})}function S(){const e=document.getElementById("studyGoalsList");e.innerHTML="",I.forEach(n=>{const s=document.createElement("div");s.className="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-100 dark:border-gray-700/50 group transition-all",n.completed&&s.classList.add("opacity-60"),s.innerHTML=`
            <div class="flex items-center gap-3 w-full">
                <button class="goal-toggle shrink-0 w-6 h-6 rounded-full border-2 ${n.completed?"bg-primary border-primary text-white":"border-gray-300 dark:border-gray-600"} flex items-center justify-center transition">
                    ${n.completed?'<span class="material-symbols-outlined text-sm">check</span>':""}
                </button>
                <span class="text-sm font-medium break-all ${n.completed?"line-through text-gray-400":""}">${n.text}</span>
            </div>
            <button class="goal-delete opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 transition p-1">
                <span class="material-symbols-outlined text-lg">delete</span>
            </button>
        `,s.querySelector(".goal-toggle").addEventListener("click",()=>{n.completed=!n.completed,S(),L()}),s.querySelector(".goal-delete").addEventListener("click",()=>{I=I.filter(t=>t.id!==n.id),S(),L()}),e.appendChild(s)})}function F(){const e=document.getElementById("addToScheduleBtn"),n=document.getElementById("eventModal"),s=document.getElementById("closeEventModal"),t=document.getElementById("saveEventBtn"),o=document.getElementById("eventInput"),d=document.getElementById("eventDayInput"),a=document.getElementById("startTimeInput"),r=document.getElementById("endTimeInput"),l=document.getElementById("selectedColorInput");e&&n&&e.addEventListener("click",()=>{f=null;const y=n.querySelector("h3");y&&(y.innerText="Add Study Time to Schedule");const i=new Date;a.value=`${i.getHours().toString().padStart(2,"0")}:00`,r.value=`${(i.getHours()+1).toString().padStart(2,"0")}:00`,d.value=i.getDay()===0?6:i.getDay()-1,n.classList.remove("hidden"),n.classList.add("flex")}),s&&s.addEventListener("click",()=>{f=null,n.classList.add("hidden"),n.classList.remove("flex")}),t&&t.addEventListener("click",()=>{const y=o.value.trim()||"Study Session",i=d.value,g=parseInt(a.value.split(":")[0]),c={subject:y,start:a.value,end:r.value,location:"",type:"Study",teacher:"",color:l.value,weekType:"every"},E=`study-schedule-${i}-${g}`;f&&f!==E&&delete u.studySchedule[f],u.studySchedule[E]=JSON.stringify(c),x(),f=null,n.classList.add("hidden"),n.classList.remove("flex"),setTimeout(()=>b(),100),typeof showConfirmationModal=="function"&&showConfirmationModal("Updated!","Your study session has been saved.",()=>{},!1)}),document.querySelectorAll(".color-btn").forEach(y=>{y.addEventListener("click",i=>{document.querySelectorAll(".color-btn").forEach(g=>{g.classList.remove("ring-offset-2","ring-gray-400","scale-110"),g.classList.add("ring-transparent")}),i.target.classList.remove("ring-transparent"),i.target.classList.add("ring-offset-2","ring-gray-400","scale-110"),l.value=i.target.dataset.color})})}function J(){const e=document.getElementById("hamburgerBtn"),n=document.getElementById("appSidebar"),s=document.getElementById("sidebarOverlay"),t=document.getElementById("closeSidebarBtn");function o(c){!n||!s||(c?(n.classList.remove("-translate-x-full"),s.classList.remove("hidden"),setTimeout(()=>s.classList.remove("opacity-0"),10)):(n.classList.add("-translate-x-full"),s.classList.add("opacity-0"),setTimeout(()=>s.classList.add("hidden"),300)))}e&&e.addEventListener("click",c=>{c.stopPropagation(),o(!0)}),t&&t.addEventListener("click",()=>o(!1)),s&&s.addEventListener("click",()=>o(!1));const d=document.getElementById("profileDropdownBtn"),a=document.getElementById("profileDropdownMenu"),r=document.getElementById("closeDropdownBtn"),l=document.getElementById("dropdownSettingsBtn"),y=document.getElementById("sidebarSettingsBtn"),i=document.getElementById("settingsModal");d&&a&&(d.addEventListener("click",c=>{c.stopPropagation(),a.classList.toggle("hidden")}),document.addEventListener("click",c=>{!d.contains(c.target)&&!a.contains(c.target)&&a.classList.add("hidden")})),r&&a&&r.addEventListener("click",()=>a.classList.add("hidden")),l&&i&&l.addEventListener("click",()=>{a.classList.add("hidden");const c=document.getElementById("setBtnAccount");c&&c.click(),i.classList.remove("hidden"),i.classList.add("flex")}),y&&i&&y.addEventListener("click",()=>{o(!1);const c=document.getElementById("setBtnAccount");c&&c.click(),i.classList.remove("hidden"),i.classList.add("flex")});const g=document.getElementById("menuSignOutBtn");g&&g.addEventListener("click",async()=>{await N(),window.location.href="/pages/login/"})}function Q(e){const n=document.getElementById("menuUserName"),s=document.getElementById("menuUserEmail"),t=document.getElementById("navProfileImg"),o=document.getElementById("navProfileIcon"),d=document.getElementById("menuProfileImg"),a=document.getElementById("menuProfileIcon");s&&(s.innerText=e.email);const r=u.settings||{};n&&(n.innerText=r.userFirstName?r.userFirstName:e.displayName?e.displayName.split(" ")[0]:"Student");const l=r.userProfileImage;l&&(t&&(t.src=l,t.classList.remove("hidden")),o&&o.classList.add("hidden"),d&&(d.src=l,d.classList.remove("hidden")),a&&a.classList.add("hidden"))}
