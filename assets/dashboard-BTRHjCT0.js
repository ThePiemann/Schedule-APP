import{o as Z,d as q,a as W,b as ee,g as V,l as te,f as ue,u as O,s as me}from"./auth-cbFyKSDW.js";let g={},E=null;document.addEventListener("DOMContentLoaded",()=>{ge()});function ge(){Z(ee,async e=>{e&&(console.log("Settings: User authenticated."),E=q(W,"users",e.uid),await fe(e))}),ye(),Le()}async function fe(e){try{const o=await V(E);if(o.exists()){const t=o.data();if(g={...t.settings,userProfileImage:t.settings?.userProfileImage||null},k(g),he(e,g),T("settingThemeToggle",g.isDarkMode==="true"),T("settingVibrantToggle",g.isVibrant==="true"),T("settingWeatherToggle",g.isWeatherEnabled==="true"),T("settingShowWeekCounter",g.showWeekCounter==="true"),T("settingEvenOddToggle",g.isEvenOddEnabled==="true"),g.userProfileImage){const n=document.getElementById("currentProfileImg"),s=document.getElementById("defaultProfileIcon");n&&s&&(n.src=g.userProfileImage,n.classList.remove("hidden"),s.classList.add("hidden"))}}}catch(o){console.error(o)}}async function p(e,o){if(E){g[e]=o;try{const t={};t[`settings.${e}`]=o,await O(E,t)}catch(t){console.error(`Failed to save ${e}:`,t)}(e==="userProfileImage"||e==="userFirstName"||e==="userLastName")&&pe();try{const t={};t[`settings.${e}`]=o,await O(E,t)}catch(t){console.error(t)}}}function pe(){const e=document.getElementById("navProfileImg"),o=document.getElementById("navProfileIcon"),t=document.getElementById("menuProfileImg"),n=document.getElementById("menuProfileIcon"),s=document.getElementById("menuUserName"),i=g.userProfileImage;i?(e&&(e.src=i,e.classList.remove("hidden")),o&&o.classList.add("hidden"),t&&(t.src=i,t.classList.remove("hidden")),n&&n.classList.add("hidden")):(e&&e.classList.add("hidden"),o&&o.classList.remove("hidden"),t&&t.classList.add("hidden"),n&&n.classList.remove("hidden")),s&&g.userFirstName&&(s.innerText=`${g.userFirstName} ${g.userLastName||""}`)}function ye(){x("settingThemeToggle",a=>{p("isDarkMode",a?"true":"false"),k({...g,isDarkMode:a?"true":"false"})}),x("settingVibrantToggle",a=>{p("isVibrant",a?"true":"false"),k({...g,isVibrant:a?"true":"false"})}),x("settingWeatherToggle",a=>{p("isWeatherEnabled",a?"true":"false"),typeof handleWeatherToggle=="function"&&handleWeatherToggle(a)}),x("settingShowWeekCounter",a=>{p("showWeekCounter",a?"true":"false")}),x("settingEvenOddToggle",a=>{p("isEvenOddEnabled",a?"true":"false")}),x("settingMotionToggle",a=>{p("reduceMotion",a?"true":"false"),k({...g,reduceMotion:a?"true":"false"})}),document.querySelectorAll(".theme-btn").forEach(a=>{a.addEventListener("click",d=>{const r=d.target.dataset.theme;p("appAccent",r),k({...g,appAccent:r})})});const o=document.getElementById("signOutBtn");o&&o.addEventListener("click",async()=>{await te(),window.location.href="/pages/login/"});const t=document.getElementById("deleteAccountBtn");t&&t.addEventListener("click",async()=>{if(confirm("DANGER: Are you sure? This will permanently delete your account.")){const a=await ue();a.success?(alert("Account deleted."),window.location.href="/pages/signup/"):alert("Error: "+a.errorMessage)}});const n=document.getElementById("settingsBtn"),s=document.getElementById("settingsModal"),i=document.getElementById("closeSettingsModal");n&&s&&n.addEventListener("click",()=>{ne("Account"),s.classList.remove("hidden"),s.classList.add("flex")}),i&&s&&i.addEventListener("click",()=>{s.classList.add("hidden"),s.classList.remove("flex")}),ve(),Ie()}function x(e,o){const t=document.getElementById(e);t&&t.addEventListener("change",n=>o(n.target.checked))}function T(e,o){const t=document.getElementById(e);t&&(t.checked=o)}function k(e){const o=document.documentElement,t=e.isDarkMode==="true",n=e.isVibrant==="true",s=e.appAccent||"blue",i=e.reduceMotion==="true";t?o.classList.add("dark"):o.classList.remove("dark"),n?o.classList.add("vibrant"):o.classList.remove("vibrant"),o.setAttribute("data-theme",s),i?o.setAttribute("data-motion","reduce"):o.removeAttribute("data-motion"),document.querySelectorAll(".theme-btn").forEach(a=>{a.dataset.theme===s?a.classList.add("ring-2","ring-gray-400"):a.classList.remove("ring-2","ring-gray-400")})}function ve(){const e=document.getElementById("firstNameInput"),o=document.getElementById("lastNameInput");let t=null;const n=(s,i)=>{clearTimeout(t),t=setTimeout(()=>p(s,i),1e3)};e&&e.addEventListener("input",s=>n("userFirstName",s.target.value)),o&&o.addEventListener("input",s=>n("userLastName",s.target.value)),Ee()}function he(e,o){const t=document.getElementById("settingsEmailDisplay");t&&e.email&&(t.value=e.email);const n=document.getElementById("firstNameInput"),s=document.getElementById("lastNameInput");n&&o.userFirstName&&(n.value=o.userFirstName),s&&o.userLastName&&(s.value=o.userLastName)}function Ee(){const e=document.getElementById("uploadProfileBtn"),o=document.getElementById("removeProfileBtn"),t=document.getElementById("uploadProfileInput"),n=document.getElementById("currentProfileImg"),s=document.getElementById("defaultProfileIcon"),i=document.getElementById("cropModal"),a=document.getElementById("cropImageToEdit"),d=document.getElementById("confirmCropBtn"),r=document.getElementById("cancelCropBtn"),l=document.getElementById("closeCropBtn");let u=null;e&&t&&e.addEventListener("click",()=>t.click()),t&&t.addEventListener("change",m=>{const B=m.target.files[0];if(B){const N=new FileReader;N.onload=ce=>{a.src=ce.target.result,i.classList.remove("hidden"),i.classList.add("flex"),u&&u.destroy(),u=new Cropper(a,{aspectRatio:1,viewMode:1})},N.readAsDataURL(B)}m.target.value=""});const f=()=>{i.classList.add("hidden"),i.classList.remove("flex"),u&&(u.destroy(),u=null)};d&&d.addEventListener("click",()=>{if(!u)return;const B=u.getCroppedCanvas({width:300,height:300}).toDataURL();p("userProfileImage",B),n&&s&&(n.src=B,n.classList.remove("hidden"),s.classList.add("hidden")),f()}),r&&r.addEventListener("click",f),l&&l.addEventListener("click",f),o&&o.addEventListener("click",()=>{confirm("Remove profile picture?")&&(p("userProfileImage",null),n&&s&&(n.src="",n.classList.add("hidden"),s.classList.remove("hidden")))})}function Ie(){const e=document.getElementById("exportDataBtn");e&&e.addEventListener("click",async()=>{if(!E){alert("Not synced yet.");return}const n=await V(E);if(n.exists()){const s=n.data(),i=new Blob([JSON.stringify(s)],{type:"application/json"}),a=URL.createObjectURL(i),d=document.createElement("a");d.href=a,d.download="studentdash_cloud_backup.json",d.click()}});const o=document.getElementById("importDataBtn"),t=document.getElementById("importDataInput");o&&t&&(o.addEventListener("click",()=>t.click()),t.addEventListener("change",n=>{const s=n.target.files[0];if(!s)return;const i=new FileReader;i.onload=async a=>{try{const d=JSON.parse(a.target.result);confirm("Importing data will OVERWRITE your Cloud data. Continue?")&&(await O(E,d),alert("Data imported! Reloading..."),location.reload())}catch{alert("Invalid data file.")}},i.readAsText(s),n.target.value=""}))}function Le(){["Account","Schedule","Notifications","Theme","About"].forEach(o=>{const t=document.getElementById(`setBtn${o}`);t&&t.addEventListener("click",()=>ne(o))})}function ne(e){["Account","Schedule","Notifications","Theme","About"].forEach(t=>{const n=document.getElementById(`setBtn${t}`),s=document.getElementById(`setSection${t}`);t===e?(n&&n.classList.add("active"),s&&s.classList.remove("hidden")):(n&&n.classList.remove("active"),s&&s.classList.add("hidden"))})}const Be="modulepreload",xe=function(e){return"/"+e},G={},we=function(o,t,n){let s=Promise.resolve();if(t&&t.length>0){let r=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),d=a?.nonce||a?.getAttribute("nonce");s=r(t.map(l=>{if(l=xe(l),l in G)return;G[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Be,u||(m.as="script"),m.crossOrigin="",m.href=l,d&&m.setAttribute("nonce",d),document.head.appendChild(m),u)return new Promise((B,N)=>{m.addEventListener("load",B),m.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=a,window.dispatchEvent(d),!d.defaultPrevented)throw a}return s.then(a=>{for(const d of a||[])d.status==="rejected"&&i(d.reason);return o().catch(i)})};let c={schedule:{},advancedTodos:[],subjectColors:{},settings:{}},L={currentUser:null,isEvenWeek:!1};function oe(e){L.currentUser=e}function U(e){if(!e)return"#F3F4F6";const o=e.trim().toUpperCase();if(c.subjectColors[o])return c.subjectColors[o];const n=`hsl(${Math.floor(Math.random()*360)}, 95%, 90%)`;return c.subjectColors[o]=n,y(),n}function b(e,o){if(!e)return null;try{if(typeof e=="object")return e;if(e.startsWith("{")){const t=JSON.parse(e);return t.type||(t.type=""),t.teacher||(t.teacher=""),t.weekType||(t.weekType="every"),(!t.color||t.color==="#F3F4F6")&&(t.color=U(t.subject)),t}}catch{}return{subject:e,start:`${o.toString().padStart(2,"0")}:00`,end:`${(o+1).toString().padStart(2,"0")}:00`,location:"",type:"",teacher:"",color:U(e),weekType:"every"}}async function se(e){if(L.currentUser)try{const o=q(W,"users",L.currentUser.uid),t=await V(o);if(t.exists()){const n=t.data();if(c.schedule=n.schedule||{},typeof n.advancedTodos=="string")try{c.advancedTodos=JSON.parse(n.advancedTodos)}catch{c.advancedTodos=[]}else c.advancedTodos=n.advancedTodos||[];if(typeof n.subjectColors=="string")try{c.subjectColors=JSON.parse(n.subjectColors)}catch{c.subjectColors={}}else c.subjectColors=n.subjectColors||{};c.settings=n.settings||{},console.log("Data loaded from Cloud"),e&&e()}else console.log("New user - starting with empty data."),y()}catch(o){console.error("Error loading data:",o)}}async function y(){if(!L.currentUser)return;const e={schedule:c.schedule,advancedTodos:JSON.stringify(c.advancedTodos),subjectColors:JSON.stringify(c.subjectColors),lastUpdated:new Date().toISOString()};try{await me(q(W,"users",L.currentUser.uid),e,{merge:!0}),console.log("Saved to Cloud...")}catch(o){console.error("Error saving data:",o)}}window.saveUserData=y;const be=Object.freeze(Object.defineProperty({__proto__:null,appState:L,getSubjectColor:U,loadUserData:se,parseSlotData:b,saveUserData:y,setCurrentUser:oe,userData:c},Symbol.toStringTag,{value:"Module"})),z=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],R=7,H=20;let I=null,w=new Date,F=new Date;function h(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}function D(){const e=document.getElementById("calendarGrid");if(!e)return;e.innerHTML="";const o=document.createElement("div");o.className="header-cell",o.innerText="TIME",e.appendChild(o),z.forEach(n=>{const s=document.createElement("div");s.className="header-cell",s.innerText=n,e.appendChild(s)});let t=0;for(let n=R;n<=H;n++){const s=document.createElement("div");s.className="time-label",s.innerText=`${n}:00`,e.appendChild(s),z.forEach((i,a)=>{const d=document.createElement("div");d.className="slot group",d.dataset.day=a,d.dataset.hour=n,d.addEventListener("dragover",Me),d.addEventListener("dragenter",Ne),d.addEventListener("dragleave",Ce),d.addEventListener("drop",$e),d.addEventListener("click",l=>{if(d.classList.contains("just-dropped")){d.classList.remove("just-dropped");return}Pe(d)});const r=c.schedule[`schedule-${a}-${n}`];if(r){const l=b(r,n);d.style.backgroundColor=l.color,d.style.color="#1f2937",d.draggable=!0,d.addEventListener("dragstart",De),d.innerHTML=`
                    <div class="class-entry-animate w-full h-full relative" style="animation-delay: ${t*.05}s">
                        ${l.weekType!=="every"?`<div class="absolute top-1 left-1 text-[8px] font-black uppercase tracking-wider text-gray-500 opacity-60 pointer-events-none select-none">${h(l.weekType)}</div>`:""}
                        ${l.location?`<div class="absolute top-1 right-1 text-[9px] font-bold text-gray-600 opacity-80 pointer-events-none select-none">${h(l.location)}</div>`:""}
                        <div class="absolute inset-0 flex flex-col justify-center items-center pointer-events-none px-1">
                            <div class="font-black text-[11px] leading-tight uppercase tracking-tight text-gray-900 line-clamp-2">${h(l.subject)}</div>
                            <div class="text-[9px] font-semibold text-gray-500 mt-0.5">${l.start}-${l.end}</div>
                        </div>
                        ${l.type?`<div class="absolute bottom-1 right-1 text-[8px] font-bold uppercase text-gray-500 tracking-wider opacity-80 pointer-events-none select-none">${h(l.type)}</div>`:""}
                    </div>
                `,t++}e.appendChild(d)})}}function S(){const e=document.getElementById("monthGrid"),o=document.getElementById("currentMonthLabel");if(!e)return;e.innerHTML="";const t=w.getFullYear(),n=w.getMonth();o&&(o.innerText=new Date(t,n).toLocaleDateString("en-US",{month:"short",year:"numeric"}));const s=new Date(t,n,1).getDay(),i=new Date(t,n+1,0).getDate(),a=new Date;for(let d=0;d<s;d++)e.appendChild(document.createElement("div"));for(let d=1;d<=i;d++){const r=document.createElement("div");r.className="month-day text-gray-700 dark:text-gray-300",r.innerText=d,d===a.getDate()&&n===a.getMonth()&&t===a.getFullYear()&&r.classList.add("today");let l=new Date(t,n,d).getDay(),u=l===0?6:l-1,f=!1;for(let m=R;m<=H;m++)c.schedule[`schedule-${u}-${m}`]&&(f=!0);if(f){const m=document.createElement("div");m.className="class-dot",r.appendChild(m)}r.addEventListener("click",()=>{document.querySelectorAll(".month-day").forEach(m=>m.classList.remove("selected-day")),r.classList.add("selected-day"),F=new Date(t,n,d),ae(u,F)}),e.appendChild(r)}}function ae(e,o){F=o;const t=document.getElementById("dailyOverview"),n=document.getElementById("overviewDateLabel");if(!t)return;t.innerHTML="",o&&(n.innerText=o.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}));let s=!1,i=0;for(let a=R;a<=H;a++){const d=c.schedule[`schedule-${e}-${a}`];if(d){const r=b(d,a);if(r.weekType==="even"&&!L.isEvenWeek||r.weekType==="odd"&&L.isEvenWeek)continue;s=!0;const l=document.createElement("div");l.className="class-entry-animate flex items-stretch gap-3 p-2 rounded hover:bg-gray-50 dark:hover:bg-white/5 transition",l.style.animationDelay=`${i*.1}s`,l.innerHTML=`
                <div class="w-1.5 rounded-full shadow-sm flex-shrink-0" style="background-color: ${r.color}"></div>
                <div class="flex-1 flex justify-between gap-2 py-1">
                    <div class="flex flex-col justify-center">
                        <p class="text-sm font-bold text-gray-800 dark:text-gray-200 leading-tight">${h(r.subject)}</p>
                        <div class="flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400 mt-1">
                            <span class="material-symbols-outlined text-[10px]">schedule</span>
                            <span>${r.start} - ${r.end}</span>
                        </div>
                        ${r.location?`<div class="flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400 mt-0.5"><span class="material-symbols-outlined text-[10px]">location_on</span><span>${h(r.location)}</span></div>`:""}
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        ${r.type?`<span class="text-[9px] uppercase font-bold bg-gray-100 dark:bg-gray-700 text-gray-500 px-1.5 py-0.5 rounded tracking-wide">${h(r.type)}</span>`:""}
                        ${r.weekType!=="every"?`<span class="text-[8px] uppercase font-bold border border-gray-200 dark:border-gray-600 text-gray-400 px-1.5 py-0.5 rounded tracking-wide whitespace-nowrap">${h(r.weekType)} ONLY</span>`:""}
                    </div>
                </div>
            `,t.appendChild(l),i++}}s||(t.innerHTML='<div class="text-center py-2 text-gray-400 text-xs italic animate-fade-in">No classes.</div>')}function Te(){const e=document.getElementById("monthView"),o=document.getElementById("weekView"),t=document.getElementById("toggleBtnText"),n=document.getElementById("monthNav"),s=document.getElementById("calendarTitle"),i=document.getElementById("downloadScheduleBtn");e.classList.contains("hidden")?(e.classList.remove("hidden"),o.classList.add("hidden"),o.classList.remove("flex"),t.innerText="Edit",n.classList.remove("hidden"),s.innerText="Class Schedule",i.classList.add("hidden"),i.classList.remove("flex"),S()):(e.classList.add("hidden"),o.classList.remove("hidden"),o.classList.add("flex"),t.innerText="Back",n.classList.add("hidden"),s.innerText="Weekly Editor",i.classList.remove("hidden"),i.classList.add("flex"))}function ke(){document.getElementById("toggleViewBtn")?.addEventListener("click",Te),document.getElementById("prevMonth")?.addEventListener("click",()=>{w.setMonth(w.getMonth()-1),S()}),document.getElementById("nextMonth")?.addEventListener("click",()=>{w.setMonth(w.getMonth()+1),S()}),document.getElementById("closeEventModal")?.addEventListener("click",_),document.getElementById("saveEventBtn")?.addEventListener("click",K),document.getElementById("deleteEventBtn")?.addEventListener("click",de),document.getElementById("eventInput")?.addEventListener("keypress",e=>{e.key==="Enter"&&K()}),Se()}function Se(){const e=document.querySelectorAll(".color-btn");e.forEach(t=>{t.addEventListener("click",n=>{e.forEach(s=>{s.classList.remove("ring-offset-2","ring-gray-400","scale-110"),s.classList.add("ring-transparent")}),n.target.classList.remove("ring-transparent"),n.target.classList.add("ring-offset-2","ring-gray-400","scale-110"),document.getElementById("selectedColorInput").value=n.target.dataset.color})});const o=document.querySelectorAll(".week-type-btn");o.forEach(t=>{t.addEventListener("click",n=>{o.forEach(s=>s.className="week-type-btn flex-1 py-1 text-xs font-bold rounded text-gray-500 hover:text-gray-700 transition"),n.target.className="week-type-btn flex-1 py-1 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-primary transition",document.getElementById("weekTypeInput").value=n.target.dataset.val})})}function De(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("application/json",JSON.stringify({day:this.dataset.day,hour:this.dataset.hour})),this.style.opacity="0.4"}function Me(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function Ne(e){this.classList.add("drag-over")}function Ce(e){this.classList.remove("drag-over")}function $e(e){e.stopPropagation(),e.preventDefault(),this.classList.remove("drag-over");const o=e.dataTransfer.getData("application/json");if(!o)return;const t=JSON.parse(o),n=this.dataset.day,s=parseInt(this.dataset.hour),i=`schedule-${t.day}-${t.hour}`,a=`schedule-${n}-${s}`;if(t.day==n&&t.hour==s){document.querySelector(`.slot[data-day="${t.day}"][data-hour="${t.hour}"]`).style.opacity="1";return}const d=c.schedule[i];let r=d?b(d,parseInt(t.hour)):null,l=c.schedule[a]?b(c.schedule[a],s):null;if(r&&(r.start=`${s.toString().padStart(2,"0")}:00`,r.end=`${(s+1).toString().padStart(2,"0")}:00`),l){const u=parseInt(t.hour);l.start=`${u.toString().padStart(2,"0")}:00`,l.end=`${(u+1).toString().padStart(2,"0")}:00`}r?c.schedule[a]=JSON.stringify(r):delete c.schedule[a],l?c.schedule[i]=JSON.stringify(l):delete c.schedule[i],this.classList.add("just-dropped"),D(),y()}function Pe(e){I=e;const o=document.getElementById("eventModal"),t=c.settings.isEvenOddEnabled==="true",n=document.getElementById("weekTypeContainer");n&&(t?n.classList.remove("hidden"):n.classList.add("hidden"));const s=parseInt(e.dataset.hour),i=c.schedule[`schedule-${e.dataset.day}-${s}`];let a={subject:"",start:`${s.toString().padStart(2,"0")}:00`,end:`${(s+1).toString().padStart(2,"0")}:00`,location:"",type:"",teacher:"",color:"#F3F4F6",weekType:"every"};i&&(a=b(i,s)),document.getElementById("eventInput").value=a.subject,document.getElementById("startTimeInput").value=a.start,document.getElementById("endTimeInput").value=a.end,document.getElementById("locationInput").value=a.location,document.getElementById("eventTypeInput").value=a.type,document.getElementById("eventTeacherInput").value=a.teacher,document.getElementById("selectedColorInput").value=a.color,document.getElementById("weekTypeInput").value=a.weekType,document.querySelectorAll(".color-btn").forEach(d=>{d.classList.remove("ring-offset-2","ring-gray-400","scale-110"),d.classList.add("ring-transparent"),d.dataset.color===a.color&&(d.classList.remove("ring-transparent"),d.classList.add("ring-offset-2","ring-gray-400","scale-110"))}),document.querySelectorAll(".week-type-btn").forEach(d=>{d.dataset.val===a.weekType?d.className="week-type-btn flex-1 py-1 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-primary transition":d.className="week-type-btn flex-1 py-1 text-xs font-bold rounded text-gray-500 hover:text-gray-700 transition"}),o.classList.remove("hidden"),o.classList.add("flex"),document.getElementById("eventInput").focus()}function _(){document.getElementById("eventModal").classList.add("hidden"),document.getElementById("eventModal").classList.remove("flex"),I=null}function K(){if(!I)return;const e=document.getElementById("eventInput").value.trim();if(e===""){de();return}const o=document.getElementById("startTimeInput").value,t=document.getElementById("endTimeInput").value,n=document.getElementById("locationInput").value.trim(),s=document.getElementById("eventTypeInput").value,i=document.getElementById("eventTeacherInput").value.trim(),a=document.getElementById("selectedColorInput").value,d=document.getElementById("weekTypeInput").value;c.subjectColors[e.toUpperCase()]=a;const r={subject:e,start:o,end:t,location:n,type:s,teacher:i,color:a,weekType:d},l=`schedule-${I.dataset.day}-${I.dataset.hour}`;c.schedule[l]=JSON.stringify(r),_(),D(),y()}function de(){if(!I)return;const e=`schedule-${I.dataset.day}-${I.dataset.hour}`;delete c.schedule[e],_(),D(),y()}let C=null,j="all",$=null;function Ae(){v("addTodoBtn",Q),document.getElementById("todoInput")?.addEventListener("keypress",e=>{e.key==="Enter"&&Q()}),v("cancelTodoBtn",ie),v("saveTodoDetailsBtn",je),document.getElementById("filterAllBtn")?.addEventListener("click",()=>A("all")),document.getElementById("filterTodayBtn")?.addEventListener("click",()=>A("today")),document.getElementById("filterUpcomingBtn")?.addEventListener("click",()=>A("upcoming")),v("closeNoteBtn",le),v("saveNoteBtn",Re),v("cancelDeleteBtn",re),v("confirmDeleteBtn",We),v("todoModalPinBtn",J),document.querySelectorAll(".p-btn").forEach(e=>{e.addEventListener("click",o=>{document.querySelectorAll(".p-btn").forEach(t=>t.classList.remove("selected","ring-2","ring-primary")),o.currentTarget.classList.add("selected","ring-2","ring-primary")})})}function M(){const e=document.getElementById("todoList");if(!e)return;e.innerHTML="";let o=c.advancedTodos||[],t=o;if(j==="today"){const n=new Date().toDateString();t=o.filter(s=>s.deadlineISO?new Date(s.deadlineISO).toDateString()===n:!1)}else if(j==="upcoming"){const n=new Date;n.setHours(0,0,0,0),t=o.filter(s=>{if(!s.deadlineISO)return!1;const i=new Date(s.deadlineISO);return i.setHours(0,0,0,0),i>n})}if(t.sort((n,s)=>{if(n.pinned&&!s.pinned)return-1;if(!n.pinned&&s.pinned)return 1;const i={high:3,med:2,low:1},a=i[s.priority]-i[n.priority];if(a!==0)return a;const d=n.deadlineISO?new Date(n.deadlineISO).getTime():9999999999999,r=s.deadlineISO?new Date(s.deadlineISO).getTime():9999999999999;return d-r}),t.length===0){e.innerHTML='<div class="text-center text-gray-400 mt-10 text-sm italic animate-fade-in">No tasks found.</div>';return}t.forEach((n,s)=>Oe(n,e,s))}function Oe(e,o,t=0){const n=document.createElement("div");n.className="task-item group relative flex items-center justify-between p-3 rounded-lg bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all shadow-sm border border-gray-100 dark:border-gray-700 cursor-pointer mb-2 transform hover:-translate-y-0.5 hover:shadow-md",e.pinned&&(n.classList.add("task-pinned","border-l-4"),n.classList.remove("border-gray-100","dark:border-gray-700")),n.addEventListener("click",()=>{const r=n.classList.contains("active");document.querySelectorAll(".task-item.active").forEach(l=>l.classList.remove("active")),r||n.classList.add("active")});const s=Math.min(t*.05,.5);n.style.animationDelay=`${s}s`;let i="bg-yellow-500";e.priority==="high"&&(i="bg-red-500"),e.priority==="low"&&(i="bg-green-500");const d=e.note&&e.note.trim().length>0?"text-blue-500":"text-gray-300 dark:text-gray-600";n.innerHTML=`
        <div class="flex items-center gap-3 flex-1 min-w-0">
             ${e.pinned?'<span class="material-symbols-outlined text-xs text-primary -mr-1 rotate-45">keep</span>':""}
            <div class="flex-1 min-w-0">
                <p class="text-sm font-semibold text-gray-800 dark:text-gray-200 truncate leading-snug select-text">${He(e.text)}</p>
                <div class="flex items-center gap-2 text-[10px] text-gray-400 mt-0.5">
                    <span>${e.deadlineText}</span>
                    <span class="hidden countdown-timer font-mono text-primary font-bold"></span>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-2 shrink-0">
             <div class="flex items-center gap-1 pl-2 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-[.active]:opacity-100 group-[.active]:pointer-events-auto transition-all duration-200">
                <button class="note-btn p-1.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition ${d}"><span class="material-symbols-outlined text-lg">description</span></button>
                <button class="edit-btn text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 p-1.5 rounded-md transition"><span class="material-symbols-outlined text-lg">edit</span></button>
                <button class="delete-btn text-red-400 hover:text-red-600 p-1.5 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 transition"><span class="material-symbols-outlined text-lg">delete</span></button>
            </div>
            <div class="w-2.5 h-2.5 rounded-full ${i} shrink-0 ring-2 ring-white dark:ring-gray-700 shadow-sm ml-1"></div>
        </div>
    `,n.querySelector(".edit-btn").addEventListener("click",r=>{r.stopPropagation(),Fe(e.id)}),n.querySelector(".note-btn").addEventListener("click",r=>{r.stopPropagation(),Ve(e.id)}),n.querySelector(".delete-btn").addEventListener("click",r=>{r.stopPropagation(),qe(e.id)}),n.dataset.deadlineIso=e.deadlineISO,o.appendChild(n)}function Ue(){const e=new Date;document.querySelectorAll("#todoList > div").forEach(o=>{const t=o.dataset.deadlineIso,n=o.querySelector(".countdown-timer");if(!t||!n)return;const s=new Date(t)-e;if(s<=0)n.innerText="Overdue",n.classList.remove("hidden"),n.classList.add("text-red-500");else{n.classList.remove("hidden"),n.classList.remove("text-red-500");const i=864e5;if(s>i){const a=Math.floor(s/i),d=Math.floor(s%i/36e5);n.innerText=`${a}d ${d}h`}else{const a=Math.floor(s/36e5),d=Math.floor(s%36e5/6e4);n.innerText=`${a}h ${d}m`}}})}function A(e){j=e;const o={all:"filterAllBtn",today:"filterTodayBtn",upcoming:"filterUpcomingBtn"},t="px-4 py-1 rounded-full bg-primary/10 text-primary text-sm font-semibold transition-colors",n="px-4 py-1 rounded-full text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm font-medium transition-colors";Object.keys(o).forEach(s=>{const i=document.getElementById(o[s]);i&&(i.className=s===e?t:n)}),M()}function Q(){const o=document.getElementById("todoInput").value.trim();C=null,document.getElementById("todoModalTitle").innerText="New Task",document.getElementById("todoModalNameInput").value=o,document.getElementById("todoDateInput").value="",document.getElementById("todoPinnedInput").value="true",J(),document.querySelectorAll(".p-btn").forEach(n=>n.classList.remove("selected","ring-2","ring-primary")),document.querySelector(".p-btn.med")?.classList.add("selected","ring-2","ring-primary");const t=document.getElementById("todoModal");t.classList.remove("hidden"),t.classList.add("flex")}function Fe(e){const t=c.advancedTodos.find(a=>a.id==e);if(!t)return;if(C=e,document.getElementById("todoModalTitle").innerText="Edit Task",document.getElementById("todoModalNameInput").value=t.text,t.deadlineISO){const a=new Date(t.deadlineISO),d=new Date(a.getTime()-a.getTimezoneOffset()*6e4).toISOString().slice(0,16);document.getElementById("todoDateInput").value=d}else document.getElementById("todoDateInput").value="";const n=t.pinned===!0;document.getElementById("todoPinnedInput").value=(!n).toString(),J(),document.querySelectorAll(".p-btn").forEach(a=>a.classList.remove("selected","ring-2","ring-primary"));const s=document.querySelector(`.p-btn[data-priority="${t.priority}"]`);s&&s.classList.add("selected","ring-2","ring-primary");const i=document.getElementById("todoModal");i.classList.remove("hidden"),i.classList.add("flex")}function je(){const e=document.getElementById("todoModalNameInput").value.trim();if(!e)return;const o=document.getElementById("todoDateInput").value,t=o?new Date(o):null,n=document.getElementById("todoPinnedInput").value==="true";let s="med";const i=document.querySelector(".p-btn.selected");i&&(s=i.dataset.priority);const a=c.advancedTodos;let d="";if(C){const r=a.findIndex(l=>l.id==C);r>-1&&(d=a[r].note||"",a[r].text=e,a[r].pinned=n,a[r].note=d,a[r].deadlineISO=t?t.toISOString():"",a[r].deadlineText=t?t.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"No Deadline",a[r].priority=s)}else{const r={id:Date.now(),text:e,note:"",pinned:n,deadlineISO:t?t.toISOString():"",deadlineText:t?t.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"No Deadline",priority:s};a.push(r)}c.advancedTodos=a,y(),M(),ie(),document.getElementById("todoInput").value=""}function ie(){document.getElementById("todoModal").classList.add("hidden"),document.getElementById("todoModal").classList.remove("flex")}function J(){const e=document.getElementById("todoPinnedInput"),o=document.getElementById("todoModalPinIcon"),t=document.getElementById("todoModalPinBtn"),n=e.value==="true";e.value=!n,n?(o.style.fontVariationSettings="'FILL' 0",t.classList.remove("text-primary"),t.classList.add("text-gray-400")):(o.style.fontVariationSettings="'FILL' 1",t.classList.add("text-primary"),t.classList.remove("text-gray-400"))}function qe(e){$=e;const o=document.getElementById("deleteModal");o.classList.remove("hidden"),o.classList.add("flex")}function re(){document.getElementById("deleteModal").classList.add("hidden"),document.getElementById("deleteModal").classList.remove("flex"),$=null}function We(){$&&(c.advancedTodos=c.advancedTodos.filter(e=>e.id!=$),M(),y()),re()}let P=null;function Ve(e){const o=c.advancedTodos.find(n=>n.id==e);if(!o)return;P=e,document.getElementById("noteInput").value=o.note||"";const t=document.getElementById("noteModal");t.classList.remove("hidden"),t.classList.add("flex")}function le(){document.getElementById("noteModal").classList.add("hidden"),document.getElementById("noteModal").classList.remove("flex"),P=null}function Re(){if(!P)return;const e=document.getElementById("noteInput").value.trim(),o=c.advancedTodos.findIndex(t=>t.id==P);o>-1&&(c.advancedTodos[o].note=e,y(),M()),le()}function v(e,o){const t=document.getElementById(e);t&&t.addEventListener("click",o)}function He(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}document.addEventListener("DOMContentLoaded",()=>{Z(ee,e=>{if(e)oe(e),console.log("Logged in as:",e.email),se(()=>{Ye(),Je(e)});else{const o=window.location.pathname;!o.includes("/login")&&!o.includes("/signup")&&(window.location.href="/pages/login/")}}),D(),Y(),S(),ke(),Ae(),typeof setupPdfListeners=="function"&&setupPdfListeners(),_e(),X(),setInterval(()=>{X(),Ue()},1e3)});function _e(){const e=document.getElementById("profileDropdownBtn"),o=document.getElementById("profileDropdownMenu"),t=document.getElementById("closeDropdownBtn"),n=document.getElementById("menuSignOutBtn"),s=document.getElementById("dropdownSettingsBtn"),i=document.getElementById("settingsModal");e&&o&&(e.addEventListener("click",a=>{a.stopPropagation(),o.classList.toggle("hidden")}),document.addEventListener("click",a=>{!e.contains(a.target)&&!o.contains(a.target)&&o.classList.add("hidden")})),t&&o&&t.addEventListener("click",a=>{a.stopPropagation(),o.classList.add("hidden")}),n&&n.addEventListener("click",async a=>{a.stopPropagation();const d=n.querySelector("p");d&&(d.innerText="Signing out..."),await te(),window.location.href="/pages/login/"}),s&&i&&s.addEventListener("click",()=>{o.classList.add("hidden");const a=document.getElementById("setBtnAccount");a&&a.click(),i.classList.remove("hidden"),i.classList.add("flex")})}function Je(e){const o=document.getElementById("navProfileImg"),t=document.getElementById("navProfileIcon"),n=document.getElementById("menuProfileImg"),s=document.getElementById("menuProfileIcon"),i=document.getElementById("menuUserName"),a=document.getElementById("menuUserEmail");a&&(a.innerText=e.email);const d=c.settings||{};i&&(i.innerText=d.userFirstName?`${d.userFirstName} ${d.userLastName||""}`:e.displayName||"Student");const r=d.userProfileImage;r?(o&&(o.src=r,o.classList.remove("hidden")),t&&t.classList.add("hidden"),n&&(n.src=r,n.classList.remove("hidden")),s&&s.classList.add("hidden")):(o&&o.classList.add("hidden"),t&&t.classList.remove("hidden"),n&&n.classList.add("hidden"),s&&s.classList.remove("hidden"))}function X(){const e=document.getElementById("datetimeDisplay");e&&(e.innerText=new Date().toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}function Ye(){D(),S(),Y();const e=new Date().getDay(),o=e===0?6:e-1;ae(o,new Date),M()}function Y(){const e=document.getElementById("weekDisplay");e&&we(()=>Promise.resolve().then(()=>be),void 0).then(o=>{const t=o.userData.settings||{};if(!(t.showWeekCounter==="true")){e.classList.add("hidden");return}e.classList.remove("hidden");const s=new Date;let i=Math.ceil(((s-new Date(s.getFullYear(),0,1))/864e5+new Date(s.getFullYear(),0,1).getDay()+1)/7);i+=1;const a=t.weekParityInvert==="true";let d=i%2===0;a&&(d=!d),o.appState.isEvenWeek=d,e.innerText=d?"Week: EVEN":"Week: ODD",e.className="week-badge text-xs font-bold px-3 py-1 rounded transition-colors"})}window.initWeekCounter=Y;
