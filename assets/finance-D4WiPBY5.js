import{o as ee,b as te,l as ne}from"./auth-cbFyKSDW.js";import{setCurrentUser as se,loadUserData as ae,userData as g,saveUserData as oe}from"./store-B1XsjTCK.js";document.addEventListener("DOMContentLoaded",()=>{ee(te,t=>{t?(se(t),ae(()=>{de(t)})):window.location.href="/pages/login/"}),ye(),fe(),ue(),ge()});let x=[],L=[],h=[],D=[],k=100,$=null,b=1;const O=5;function de(t){ve(t),g.finance||(g.finance={transactions:[],subscriptions:[],debts:[],goals:[],budget:100}),x=g.finance.transactions||[],L=g.finance.subscriptions||[],h=g.finance.debts||[],D=g.finance.goals||[],k=parseFloat(g.finance.budget)||100,E()}function I(){g.finance={transactions:x,subscriptions:L,debts:h,goals:D,budget:k},oe(),localStorage.setItem("studentDash_finance",JSON.stringify(g.finance))}const V=localStorage.getItem("studentDash_finance");V&&JSON.parse(V);function E(){X(),le(),G(),ie(),ce(),me()}function X(){const t=document.getElementById("totalBalanceDisplay"),e=document.getElementById("monthlySpentDisplay"),a=document.getElementById("recurringTotalDisplay"),d=document.getElementById("budgetProgressBar"),o=document.getElementById("monthlyBudgetDisplay");let s=0,n=0,l=0;const u=new Date().getMonth();x.forEach(v=>{const w=parseFloat(v.amount);v.type==="income"?s+=w:(n+=w,new Date(v.date).getMonth()===u&&(l+=w))});const i=s-n;t.innerText=p(i),e.innerText=p(l);let r=0;L.forEach(v=>r+=parseFloat(v.cost)),a.innerText=p(r);const m=Math.min(l/k*100,100);d.style.width=`${m}%`,o&&(o.innerText=p(k));const y=e.closest(".group");if(y){const v=y.querySelector("p.italic");v&&(v.innerText=`* Percentage of your ${p(k)} monthly limit`)}i<0?t.classList.add("text-red-500"):t.classList.remove("text-red-500")}function le(){const t={0:0,1:0,2:0,3:0,4:0,5:0,6:0},e=new Date,a=e.getDay(),d=a===0?6:a-1,o=new Date(e);o.setDate(e.getDate()-d),o.setHours(0,0,0,0);const s=new Date(o);s.setDate(o.getDate()+7);let n=0;x&&x.length>0&&x.forEach(i=>{if(i.type==="expense"){const r=new Date(i.date);if(r>=o&&r<s){const m=r.getDay(),y=parseFloat(i.amount);isNaN(y)||(t[m]+=y,n+=y)}}});const l=Object.values(t),c=Math.max(...l,1);for(let i=0;i<=6;i++){const r=document.getElementById(`bar-${i}`),m=document.getElementById(`tooltip-${i}`);if(r&&m){const y=t[i],v=y/c*100;r.style.height=`${v}%`,m.innerText=p(y)}}const u=document.getElementById("chartTotalDisplay");u&&(u.innerText=`${p(n)} this week`)}function G(){const t=document.getElementById("transactionList"),e=document.getElementById("paginationControls"),a=document.getElementById("prevPageBtn"),d=document.getElementById("nextPageBtn"),o=document.getElementById("pageIndicator");if(t.innerHTML="",x.length===0){t.innerHTML=`
            <div class="text-center py-10 opacity-50">
                <span class="material-symbols-outlined text-4xl mb-2">receipt_long</span>
                <p class="text-sm font-bold">No transactions yet.</p>
            </div>`,e&&e.classList.add("hidden");return}const s=[...x].sort((i,r)=>new Date(r.date)-new Date(i.date)),n=Math.ceil(s.length/O);b>n&&(b=n),b<1&&(b=1);const l=(b-1)*O,c=l+O;s.slice(l,c).forEach(i=>{const r=document.createElement("div");r.className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700 transition group";const m=i.type==="expense",y=pe(i.category),v=m?"text-red-500":"text-green-500",w=m?"-":"+";r.innerHTML=`
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full ${m?"bg-red-100 text-red-500":"bg-green-100 text-green-500"} flex items-center justify-center">
                    <span class="material-symbols-outlined text-xl">${y}</span>
                </div>
                <div>
                    <h4 class="text-sm font-bold text-gray-800 dark:text-white">${i.description}</h4>
                    <p class="text-[10px] text-gray-500 font-medium">${new Date(i.date).toLocaleDateString()}</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span class="font-bold ${v}">${w}${p(i.amount)}</span>
                <button class="delete-trans-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${i.id}" title="Delete Transaction">
                    <span class="material-symbols-outlined text-lg">delete</span>
                </button>
            </div>
        `,t.appendChild(r)}),document.querySelectorAll(".delete-trans-btn").forEach(i=>{i.addEventListener("click",r=>{A(()=>{const m=parseInt(i.dataset.id);x=x.filter(y=>y.id!==m),I(),E()})})}),e&&(e.classList.remove("hidden"),o&&(o.innerText=`Page ${b} of ${n}`),a&&(a.disabled=b===1),d&&(d.disabled=b===n))}function ie(){const t=document.getElementById("subscriptionList");if(t.innerHTML="",L.length===0){t.innerHTML='<p class="text-xs text-gray-400 text-center py-4">No subscriptions added.</p>';return}L.forEach(e=>{const a=document.createElement("div");a.className="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded border border-gray-100 dark:border-gray-700/50 group",a.innerHTML=`
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                    <span class="text-xs font-bold text-gray-600 dark:text-gray-300">${e.name.charAt(0)}</span>
                </div>
                <div>
                    <p class="text-xs font-bold text-gray-800 dark:text-gray-200">${e.name}</p>
                    <p class="text-[10px] text-gray-400">Due day ${e.day}</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-xs font-bold text-gray-700 dark:text-gray-300">${p(e.cost)}</span>
                <button class="delete-sub-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${e.id}" title="Delete Subscription">
                    <span class="material-symbols-outlined text-lg">delete</span>
                </button>
            </div>
        `,t.appendChild(a)}),document.querySelectorAll(".delete-sub-btn").forEach(e=>{e.addEventListener("click",a=>{A(()=>{const d=parseInt(e.dataset.id);L=L.filter(o=>o.id!==d),I(),E()})})})}function ce(){const t=document.getElementById("debtList"),e=document.getElementById("totalOweDisplay"),a=document.getElementById("totalOwedDisplay");t.innerHTML="";let d=0,o=0;h.length===0?t.innerHTML='<p class="text-xs text-gray-400 text-center py-2">No debts recorded.</p>':(h.forEach(s=>{const n=parseFloat(s.amount);s.type==="owe_them"?d+=n:o+=n;const l=document.createElement("div");l.className="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded border border-gray-100 dark:border-gray-700/50 group";const c=s.type==="owe_them",u=c?"text-red-500":"text-green-500",i=c?"arrow_outward":"south_west";l.innerHTML=`
                <div class="flex items-center gap-2 overflow-hidden">
                    <div class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-700 flex items-center justify-center shrink-0">
                        <span class="material-symbols-outlined text-sm ${u}">${i}</span>
                    </div>
                    <div class="truncate">
                        <p class="text-xs font-bold text-gray-800 dark:text-gray-200 truncate">${s.person}</p>
                        <p class="text-[10px] text-gray-400 truncate">${s.description||"Debt"}</p>
                    </div>
                </div>
                <div class="flex items-center gap-1">
                    <span class="text-xs font-bold ${u} mr-1">${p(n)}</span>
                    <button class="settle-debt-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-green-500 hover:bg-green-50 dark:hover:bg-green-900/20 p-1.5 rounded-full" data-id="${s.id}" title="Mark as Paid">
                        <span class="material-symbols-outlined text-lg">check_circle</span>
                    </button>
                    <button class="delete-debt-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${s.id}" title="Delete">
                        <span class="material-symbols-outlined text-lg">delete</span>
                    </button>
                </div>
            `,t.appendChild(l)}),document.querySelectorAll(".settle-debt-btn").forEach(s=>{s.addEventListener("click",()=>{const n=parseInt(s.dataset.id);re(n)})}),document.querySelectorAll(".delete-debt-btn").forEach(s=>{s.addEventListener("click",n=>{A(()=>{const l=parseInt(s.dataset.id);h=h.filter(c=>c.id!==l),I(),E()})})})),e.innerText=p(d),a.innerText=p(o)}function re(t){const e=h.findIndex(s=>s.id===t);if(e===-1)return;const a=h[e],d=parseFloat(a.amount),o={id:Date.now(),type:a.type==="owe_me"?"income":"expense",amount:d,category:"other",description:`Settled: ${a.person} (${a.description||"IOU"})`,date:new Date().toISOString()};x.unshift(o),h.splice(e,1),I(),E()}function me(){const t=document.getElementById("goalsList"),e=document.getElementById("totalSavedDisplay"),a=document.getElementById("totalTargetDisplay");t.innerHTML="";let d=0;if(x.forEach(s=>{const n=parseFloat(s.amount);s.type==="income"?d+=n:d-=n}),e&&(e.innerText=p(Math.max(0,d))),D.length===0){t.innerHTML='<div class="text-center opacity-40 py-4"><p class="text-xs font-bold text-slate-500">No active goals</p></div>',a&&(a.innerText=p(0));return}let o=0;D.forEach(s=>{const n=parseFloat(s.target);o+=n;const l=Math.min(d/n*100,100),c=d>=n,u=document.createElement("div");u.className="group",u.innerHTML=`
            <div class="flex justify-between items-end mb-1">
                <h4 class="text-sm font-bold text-gray-700 dark:text-gray-300">${s.name}</h4>
                <div class="flex items-center gap-2">
                    <span class="text-xs font-bold ${c?"text-green-500":"text-gray-500"}">
                        ${c?"Affordable!":`${Math.floor(l)}%`}
                    </span>
                    <button class="delete-goal-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${s.id}">
                        <span class="material-symbols-outlined text-lg">delete</span>
                    </button>
                </div>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 h-2 rounded-full overflow-hidden">
                <div class="h-full rounded-full transition-all duration-500 ${c?"bg-green-500":"bg-primary"}" style="width: ${Math.max(0,l)}%"></div>
            </div>
            <p class="text-[10px] text-gray-400 mt-1 text-right">${p(n)} Target</p>
        `,t.appendChild(u)}),a&&(a.innerText=p(o)),document.querySelectorAll(".delete-goal-btn").forEach(s=>{s.addEventListener("click",()=>{A(()=>{const n=parseInt(s.dataset.id);D=D.filter(l=>l.id!==n),I(),E()})})})}function ue(){const t=document.getElementById("transactionModal"),e=document.getElementById("addTransactionBtn"),a=document.getElementById("cancelTransBtn"),d=document.getElementById("saveTransBtn"),o=document.getElementById("subModal"),s=document.getElementById("addSubBtn"),n=document.getElementById("cancelSubBtn"),l=document.getElementById("saveSubBtn"),c=document.getElementById("debtModal"),u=document.getElementById("addDebtBtn"),i=document.getElementById("cancelDebtBtn"),r=document.getElementById("saveDebtBtn"),m=document.getElementById("goalModal"),y=document.getElementById("addGoalBtn"),v=document.getElementById("cancelGoalBtn"),w=document.getElementById("saveGoalBtn"),S=document.getElementById("typeOweThemBtn"),N=document.getElementById("typeOweMeBtn"),H=document.getElementById("debtTypeInput"),T=document.getElementById("budgetModal"),q=document.getElementById("editBudgetBtn"),J=document.getElementById("cancelBudgetBtn"),R=document.getElementById("saveBudgetBtn");q&&q.addEventListener("click",()=>{document.getElementById("budgetInput").value=k,T.classList.remove("hidden"),T.classList.add("flex")}),J&&J.addEventListener("click",()=>{T.classList.add("hidden"),T.classList.remove("flex")}),R&&R.addEventListener("click",()=>{const f=parseFloat(document.getElementById("budgetInput").value);f>0&&(k=f,I(),X(),T.classList.add("hidden"),T.classList.remove("flex"))}),u&&u.addEventListener("click",()=>{c.classList.remove("hidden"),c.classList.add("flex")}),i&&i.addEventListener("click",()=>{c.classList.add("hidden"),c.classList.remove("flex")}),S&&S.addEventListener("click",()=>{H.value="owe_them",S.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-red-500 transition",N.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition"}),N&&N.addEventListener("click",()=>{H.value="owe_me",N.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-green-500 transition",S.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition"}),r&&r.addEventListener("click",()=>{const f=document.getElementById("debtPersonInput").value,B=document.getElementById("debtAmountInput").value,M=document.getElementById("debtDescInput").value,j=H.value;if(!f||!B)return alert("Please fill in person and amount");h.push({id:Date.now(),person:f,amount:parseFloat(B),description:M,type:j,date:new Date().toISOString()}),I(),E(),document.getElementById("debtPersonInput").value="",document.getElementById("debtAmountInput").value="",document.getElementById("debtDescInput").value="",c.classList.add("hidden"),c.classList.remove("flex")}),y&&y.addEventListener("click",()=>{m.classList.remove("hidden"),m.classList.add("flex")}),v&&v.addEventListener("click",()=>{m.classList.add("hidden"),m.classList.remove("flex")}),w&&w.addEventListener("click",()=>{const f=document.getElementById("goalNameInput").value,B=document.getElementById("goalTargetInput").value;!f||!B||(D.push({id:Date.now(),name:f,target:parseFloat(B)}),I(),E(),document.getElementById("goalNameInput").value="",document.getElementById("goalTargetInput").value="",m.classList.add("hidden"),m.classList.remove("flex"))});const P=document.getElementById("deleteModal"),W=document.getElementById("confirmDeleteBtn"),z=document.getElementById("cancelDeleteBtn");W&&W.addEventListener("click",()=>{$&&$(),P.classList.add("hidden"),P.classList.remove("flex"),$=null}),z&&z.addEventListener("click",()=>{P.classList.add("hidden"),P.classList.remove("flex"),$=null});const F=document.getElementById("typeExpenseBtn"),C=document.getElementById("typeIncomeBtn"),_=document.getElementById("transTypeInput"),Y=document.getElementById("transCategoryInput"),K=document.getElementById("prevPageBtn"),Q=document.getElementById("nextPageBtn");K&&K.addEventListener("click",()=>{b>1&&(b--,G())}),Q&&Q.addEventListener("click",()=>{const f=Math.ceil(x.length/O);b<f&&(b++,G())}),e&&e.addEventListener("click",()=>{U("expense"),t.classList.remove("hidden"),t.classList.add("flex")}),a&&a.addEventListener("click",()=>{t.classList.add("hidden"),t.classList.remove("flex")}),F&&F.addEventListener("click",()=>{_.value="expense",F.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-red-500 transition",C.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition",U("expense")}),C&&C.addEventListener("click",()=>{_.value="income",C.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-green-500 transition",F.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition",U("income")}),d&&d.addEventListener("click",()=>{const f=document.getElementById("transAmountInput").value,B=document.getElementById("transDescInput").value,M=Y.value,j=_.value;if(!f||!B)return alert("Please fill in amount and description");const Z={id:Date.now(),type:j,amount:parseFloat(f),category:M,description:B,date:new Date().toISOString()};x.unshift(Z),I(),E(),document.getElementById("transAmountInput").value="",document.getElementById("transDescInput").value="",t.classList.add("hidden"),t.classList.remove("flex")}),s&&s.addEventListener("click",()=>{o.classList.remove("hidden"),o.classList.add("flex")}),n&&n.addEventListener("click",()=>{o.classList.add("hidden"),o.classList.remove("flex")}),l&&l.addEventListener("click",()=>{const f=document.getElementById("subNameInput").value,B=document.getElementById("subCostInput").value,M=document.getElementById("subDayInput").value;!f||!B||!M||(L.push({id:Date.now(),name:f,cost:parseFloat(B),day:parseInt(M)}),I(),E(),document.getElementById("subNameInput").value="",document.getElementById("subCostInput").value="",document.getElementById("subDayInput").value="",o.classList.add("hidden"),o.classList.remove("flex"))})}function U(t){const e=document.getElementById("transCategoryInput");e.innerHTML="",(t==="expense"?[{val:"food",label:"Food & Dining"},{val:"transport",label:"Transportation"},{val:"school",label:"School Supplies"},{val:"entertainment",label:"Entertainment"},{val:"shopping",label:"Shopping"},{val:"other",label:"Other"}]:[{val:"allowance",label:"Allowance"},{val:"job",label:"Part-time Job"},{val:"aid",label:"Financial Aid"},{val:"other",label:"Other"}]).forEach(s=>{const n=document.createElement("option");n.value=s.val,n.innerText=s.label,e.appendChild(n)})}function ge(){const t=document.getElementById("splitTotal"),e=document.getElementById("splitPeople"),a=document.getElementById("splitResult");function d(){const o=parseFloat(t.value)||0,s=parseInt(e.value)||1;if(s<1)return;const n=o/s;a.innerText=p(n)}t&&e&&(t.addEventListener("input",d),e.addEventListener("input",d))}window.addEventListener("settingsChanged",()=>{g.finance&&(x=g.finance.transactions||[],L=g.finance.subscriptions||[],h=g.finance.debts||[],D=g.finance.goals||[],k=parseFloat(g.finance.budget)||100),E()});function A(t){$=t;const e=document.getElementById("deleteModal");e.classList.remove("hidden"),e.classList.add("flex")}function p(t){const e=g.settings?.preferredCurrency||"USD";return new Intl.NumberFormat("en-US",{style:"currency",currency:e}).format(t)}function pe(t){return{food:"fastfood",transport:"directions_bus",school:"school",entertainment:"movie",shopping:"shopping_bag",allowance:"savings",job:"work",aid:"volunteer_activism",other:"category"}[t]||"category"}function ye(){const t=document.getElementById("hamburgerBtn"),e=document.getElementById("appSidebar"),a=document.getElementById("sidebarOverlay"),d=document.getElementById("closeSidebarBtn"),o=document.getElementById("sidebarSettingsBtn"),s=document.getElementById("settingsModal");function n(l){!e||!a||(l?(e.classList.remove("-translate-x-full"),a.classList.remove("hidden"),setTimeout(()=>a.classList.remove("opacity-0"),10)):(e.classList.add("-translate-x-full"),a.classList.add("opacity-0"),setTimeout(()=>a.classList.add("hidden"),300)))}t&&t.addEventListener("click",l=>{l.stopPropagation(),n(!0)}),d&&d.addEventListener("click",()=>n(!1)),a&&a.addEventListener("click",()=>n(!1)),o&&s&&o.addEventListener("click",()=>{n(!1);const l=document.getElementById("setBtnAccount");l&&l.click(),s.classList.remove("hidden"),s.classList.add("flex")})}function fe(){const t=document.getElementById("profileDropdownBtn"),e=document.getElementById("profileDropdownMenu"),a=document.getElementById("closeDropdownBtn"),d=document.getElementById("menuSignOutBtn"),o=document.getElementById("dropdownSettingsBtn"),s=document.getElementById("settingsModal");t&&e&&(t.addEventListener("click",n=>{n.stopPropagation(),e.classList.toggle("hidden")}),document.addEventListener("click",n=>{!t.contains(n.target)&&!e.contains(n.target)&&e.classList.add("hidden")})),a&&e&&a.addEventListener("click",n=>{n.stopPropagation(),e.classList.add("hidden")}),d&&d.addEventListener("click",async n=>{n.stopPropagation(),await ne(),window.location.href="/pages/login/"}),o&&s&&o.addEventListener("click",()=>{e.classList.add("hidden"),s.classList.remove("hidden"),s.classList.add("flex");const n=document.getElementById("setBtnAccount");n&&n.click()})}function ve(t){const e=document.getElementById("navProfileImg"),a=document.getElementById("navProfileIcon"),d=document.getElementById("menuProfileImg"),o=document.getElementById("menuProfileIcon"),s=document.getElementById("menuUserName"),n=document.getElementById("menuUserEmail");n&&(n.innerText=t.email);const l=g.settings||{};s&&(s.innerText=l.userFirstName?l.userFirstName:t.displayName?t.displayName.split(" ")[0]:"Student");const c=l.userProfileImage;if(c?(e&&(e.src=c,e.classList.remove("hidden")),a&&a.classList.add("hidden"),d&&(d.src=c,d.classList.remove("hidden")),o&&o.classList.add("hidden")):(e&&e.classList.add("hidden"),a&&a.classList.remove("hidden"),d&&d.classList.add("hidden"),o&&o.classList.remove("hidden")),l.showSplitBill==="true"){const u=document.getElementById("splitBillContainer");u&&u.classList.remove("hidden")}}window.handleSplitBillToggle=function(t){const e=document.getElementById("splitBillContainer");e&&(t?e.classList.remove("hidden"):e.classList.add("hidden"))};
