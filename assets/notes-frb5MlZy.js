import{o as de,b as oe,l as ie}from"./auth-cbFyKSDW.js";import{setCurrentUser as se,loadUserData as ce,userData as C,saveUserData as ae}from"./store-B-09Ib52.js";let m=[],B="#FFFFFF",w=null,I=null,L="#FFFFFF";document.addEventListener("DOMContentLoaded",()=>{de(oe,d=>{d?(se(d),ce(()=>{le(d)})):window.location.href="/pages/login/"}),ge(),fe(),me()});function le(d){pe(d),C.notes||(C.notes=[]),m=C.notes,b()}function T(){C.notes=m,ae()}function b(){const d=document.getElementById("notesGrid"),i=document.getElementById("searchNotes").value.toLowerCase();d.innerHTML="";const c=m.filter(n=>n.title&&n.title.toLowerCase().includes(i)||n.content&&n.content.toLowerCase().includes(i));c.sort((n,t)=>t.pinned===n.pinned?new Date(t.date)-new Date(n.date):t.pinned?1:-1),c.forEach(n=>{const t=document.createElement("div");t.className="note-card bg-white dark:bg-card-dark border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm hover:shadow-md transition group break-inside-avoid relative overflow-hidden cursor-default sm:cursor-pointer",n.pinned&&t.classList.add("border-l-[6px]","border-primary"),t.style.backgroundColor=n.color,document.documentElement.classList.contains("dark")&&(n.color==="#FFFFFF"||n.color==="#F3F4F6")&&(t.style.backgroundColor="");const a="push_pin",s=n.pinned?"text-primary":"text-gray-400 opacity-0 group-hover:opacity-100",r=new Date(n.date).toLocaleDateString(void 0,{month:"short",day:"numeric"});t.innerHTML=`
            <div class="flex justify-between items-start">
                <h3 class="font-bold text-gray-800 dark:text-gray-100 text-lg leading-tight break-words w-full mr-2 min-h-[1.5rem]">${n.title||"(No Title)"}</h3>
                <button class="pin-btn ${s} hover:text-gray-600 dark:hover:text-gray-300 transition p-1 rounded-full z-10" data-id="${n.id}" title="${n.pinned?"Unpin":"Pin"}">
                    <span class="material-symbols-outlined text-xl">${a}</span>
                </button>
            </div>
            <p class="text-[10px] text-gray-400 mt-2 font-medium">${r}</p>
        `,t.addEventListener("click",f=>{f.target.closest("button")||re(n)}),d.appendChild(t)}),document.querySelectorAll(".pin-btn").forEach(n=>{n.addEventListener("click",t=>{t.stopPropagation();const a=parseInt(n.dataset.id),s=m.find(r=>r.id===a);s&&(s.pinned=!s.pinned,T(),b())})})}function re(d){I=d.id,L=d.color||"#FFFFFF";const i=document.getElementById("editNoteModal"),c=document.getElementById("editNoteContentWrapper"),n=document.getElementById("editNoteTitle"),t=document.getElementById("editNoteContent"),a=document.getElementById("editPinIcon"),s=document.getElementById("editColorMenu");n.value=d.title,t.innerHTML=d.content,c.style.backgroundColor=L,document.documentElement.classList.contains("dark")&&(L==="#FFFFFF"||L==="#F3F4F6")&&(c.style.backgroundColor=""),d.pinned?c.classList.add("border-l-[6px]","border-primary"):c.classList.remove("border-l-[6px]","border-primary"),a&&(a.innerText="push_pin",d.pinned?(a.parentElement.classList.add("text-primary"),a.parentElement.classList.remove("text-gray-500")):(a.parentElement.classList.remove("text-primary"),a.parentElement.classList.add("text-gray-500"))),s&&s.classList.add("hidden"),i.classList.remove("hidden"),i.classList.add("flex")}function X(){const d=document.getElementById("editNoteModal"),i=document.getElementById("editNoteTitle"),c=document.getElementById("editNoteContent");if(I&&i&&c){const n=i.value.trim(),t=c.innerHTML,a=m.findIndex(s=>s.id===I);if(a>-1){const s=c.innerText.trim();!n&&!s&&!t.includes("<img")?m.splice(a,1):(m[a].title=n,m[a].content=t,m[a].color=L,m[a].date=new Date().toISOString()),T(),b()}}I=null,d.classList.add("hidden"),d.classList.remove("flex")}function Y(d){d&&(d.style.height="auto",d.style.height=d.scrollHeight+"px")}function me(){const d=document.getElementById("createNoteContainer"),i=document.getElementById("createNoteCollapsed"),c=document.getElementById("createNoteExpanded"),n=document.getElementById("newNoteTitle"),t=document.getElementById("newNoteContent"),a=document.getElementById("createNoteBtn"),s=document.getElementById("cancelCreateBtn"),r=document.getElementById("colorPaletteBtn"),f=document.getElementById("colorPaletteMenu"),H=document.getElementById("linkBtn"),O=document.getElementById("editLinkBtn"),_=document.getElementById("searchNotes"),h=document.getElementById("editNoteModal"),y=document.getElementById("editNoteContentWrapper"),W=document.getElementById("editNoteTitle"),u=document.getElementById("editNoteContent"),z=document.getElementById("closeEditBtn"),V=document.getElementById("editColorBtn"),N=document.getElementById("editColorMenu"),k=document.getElementById("editPinBtn"),j=document.getElementById("editDeleteBtn"),D=document.getElementById("newNoteToolbar"),P=document.getElementById("editNoteToolbar"),U=(e,o=!1)=>{if(!e)return;e.querySelectorAll("button[data-cmd]").forEach(g=>{const v=g.dataset.cmd,R=g.dataset.val;let q=!1;if(!o)try{v==="formatBlock"?q=document.queryCommandValue(v).toLowerCase()===R.toLowerCase():v!=="removeFormat"&&(q=document.queryCommandState(v))}catch{}q?(g.classList.add("text-primary","bg-primary/10"),g.classList.remove("text-gray-500","hover:bg-gray-100","dark:hover:bg-gray-700")):(g.classList.remove("text-primary","bg-primary/10"),g.classList.add("text-gray-500","hover:bg-gray-100","dark:hover:bg-gray-700"))});const l=e.querySelector("#linkBtn")||e.querySelector("#editLinkBtn");l&&(window.getSelection().anchorNode&&window.getSelection().anchorNode.parentElement.tagName==="A"?(l.classList.add("text-primary","bg-primary/10"),l.classList.remove("text-gray-500")):(l.classList.remove("text-primary","bg-primary/10"),l.classList.add("text-gray-500")))},E=()=>{setTimeout(()=>{t&&document.activeElement===t&&U(D),u&&document.activeElement===u&&U(P)},0)},M=(e,o)=>{e&&(o?e.classList.remove("opacity-50","pointer-events-none"):(e.classList.add("opacity-50","pointer-events-none"),U(e,!0)))};let A=null;const G=()=>{const e=window.getSelection(),o=e.toString();e.rangeCount>0&&(A=e.getRangeAt(0).cloneRange()),document.getElementById("linkTextInput").value=o,document.getElementById("linkUrlInput").value="";const l=document.getElementById("insertLinkModal");l.classList.remove("hidden"),l.classList.add("flex"),setTimeout(()=>document.getElementById("linkUrlInput").focus(),100)};H&&H.addEventListener("click",e=>{e.preventDefault(),G()}),O&&O.addEventListener("click",e=>{e.preventDefault(),G()}),document.getElementById("closeLinkModalBtn")?.addEventListener("click",()=>{document.getElementById("insertLinkModal").classList.add("hidden"),document.getElementById("insertLinkModal").classList.remove("flex")}),document.getElementById("applyLinkModalBtn")?.addEventListener("click",()=>{const e=document.getElementById("linkTextInput").value.trim(),o=document.getElementById("linkUrlInput").value.trim();if(o){const l=o.match(/^https?:\/\//)?o:`https://${o}`,g=e||o,v=window.getSelection();v.removeAllRanges(),A&&v.addRange(A);const R=`<a href="${l}" target="_blank" class="text-primary underline hover:opacity-80 transition">${g}</a>&nbsp;`;document.execCommand("insertHTML",!1,R)}document.getElementById("insertLinkModal").classList.add("hidden"),document.getElementById("insertLinkModal").classList.remove("flex")});const p=document.getElementById("linkPreviewBubble"),J=document.getElementById("bubbleLinkUrl"),Z=document.getElementById("bubbleOpenBtn"),ee=document.getElementById("bubbleRemoveBtn"),te=e=>{const o=e.getBoundingClientRect();J.innerText=e.href,J.href=e.href,Z.onclick=()=>window.open(e.href,"_blank"),ee.onclick=()=>{const g=e.innerText;e.replaceWith(document.createTextNode(g)),F(),T()},p.classList.remove("hidden"),p.classList.add("flex");const l=p.getBoundingClientRect();p.style.top=`${o.top-l.height-10}px`,p.style.left=`${o.left+o.width/2-l.width/2}px`},F=()=>{p.classList.add("hidden"),p.classList.remove("flex")},S=()=>{const e=window.getSelection();if(!e.rangeCount)return F();let o=e.anchorNode;o.nodeType===3&&(o=o.parentElement);const l=o.closest("a");l&&(t.contains(l)||u.contains(l))?te(l):F()};t&&(t.addEventListener("click",()=>setTimeout(S,10)),t.addEventListener("keyup",S),t.addEventListener("blur",e=>{setTimeout(()=>{p.contains(document.activeElement)||F()},200)})),u&&(u.addEventListener("click",()=>setTimeout(S,10)),u.addEventListener("keyup",S),u.addEventListener("blur",e=>{setTimeout(()=>{p.contains(document.activeElement)||F()},200)})),t&&(t.addEventListener("input",()=>{Y(t),E()}),t.addEventListener("keyup",E),t.addEventListener("mouseup",E),t.addEventListener("focus",()=>M(D,!0))),u&&(u.addEventListener("input",()=>{Y(u),E()}),u.addEventListener("keyup",E),u.addEventListener("mouseup",E),u.addEventListener("focus",()=>M(P,!0))),n&&n.addEventListener("focus",()=>M(D,!1)),W&&W.addEventListener("focus",()=>M(P,!1)),document.querySelectorAll("[data-cmd]").forEach(e=>{e.addEventListener("mousedown",o=>o.preventDefault()),e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();const l=e.dataset.cmd,g=e.dataset.val||null;l==="removeFormat"?document.execCommand("removeFormat",!1,null):document.execCommand(l,!1,g),E()})}),i&&c&&n&&i.addEventListener("click",()=>{i.classList.add("hidden"),c.classList.remove("hidden"),n.focus()});const $=()=>{n&&(n.value=""),t&&(t.innerHTML=""),B="#FFFFFF",d&&(d.style.backgroundColor="",document.documentElement.classList.contains("dark")&&(d.style.backgroundColor="")),c&&c.classList.add("hidden"),i&&i.classList.remove("hidden"),f&&f.classList.add("hidden")},ne=()=>{const e=n?n.value.trim():"",o=t?t.innerHTML:"",l=t?t.innerText.trim():"";(e||l||o.includes("<img"))&&(m.unshift({id:Date.now(),title:e,content:o,color:B,pinned:!1,date:new Date().toISOString()}),T(),b()),$()};a&&a.addEventListener("click",ne),s&&s.addEventListener("click",$),r&&f&&r.addEventListener("click",e=>{e.stopPropagation(),f.classList.toggle("hidden")}),document.querySelectorAll(".color-option").forEach(e=>{e.addEventListener("click",o=>{o.stopPropagation(),B=e.dataset.color,d&&(d.style.backgroundColor=B),document.documentElement.classList.contains("dark")&&(B==="#FFFFFF"||B==="#F3F4F6")?d&&(d.style.backgroundColor=""):B!=="#FFFFFF"&&d&&d.classList.add("text-gray-800"),f&&f.classList.add("hidden")})}),_&&_.addEventListener("input",b),h&&(h.addEventListener("click",e=>{e.target===h&&X()}),z&&z.addEventListener("click",X),V&&N&&V.addEventListener("click",e=>{e.stopPropagation(),N.classList.toggle("hidden")}),document.querySelectorAll(".edit-color-option").forEach(e=>{e.addEventListener("click",o=>{o.stopPropagation(),L=e.dataset.color,y&&(y.style.backgroundColor=L,document.documentElement.classList.contains("dark")&&(L==="#FFFFFF"||L==="#F3F4F6")&&(y.style.backgroundColor="")),N&&N.classList.add("hidden")})}),k&&k.addEventListener("click",()=>{const e=m.find(o=>o.id===I);if(e){e.pinned=!e.pinned;const o=document.getElementById("editPinIcon");o&&(o.innerText="push_pin"),e.pinned?(k.classList.add("text-primary"),k.classList.remove("text-gray-500"),y&&y.classList.add("border-l-[6px]","border-primary")):(k.classList.remove("text-primary"),k.classList.add("text-gray-500"),y&&y.classList.remove("border-l-[6px]","border-primary"))}}),j&&j.addEventListener("click",()=>{ue(I),h&&(h.classList.add("hidden"),h.classList.remove("flex")),I=null}));const x=document.getElementById("deleteModal"),K=document.getElementById("confirmDeleteBtn"),Q=document.getElementById("cancelDeleteBtn");K&&K.addEventListener("click",()=>{w&&(m=m.filter(e=>e.id!==w),T(),b()),x&&(x.classList.add("hidden"),x.classList.remove("flex")),w=null}),Q&&Q.addEventListener("click",()=>{x&&(x.classList.add("hidden"),x.classList.remove("flex")),w=null})}function ue(d){w=d;const i=document.getElementById("deleteModal");i&&(i.classList.remove("hidden"),i.classList.add("flex"))}function ge(){const d=document.getElementById("hamburgerBtn"),i=document.getElementById("appSidebar"),c=document.getElementById("sidebarOverlay"),n=document.getElementById("closeSidebarBtn"),t=document.getElementById("sidebarSettingsBtn"),a=document.getElementById("settingsModal");function s(r){!i||!c||(r?(i.classList.remove("-translate-x-full"),c.classList.remove("hidden"),setTimeout(()=>c.classList.remove("opacity-0"),10)):(i.classList.add("-translate-x-full"),c.classList.add("opacity-0"),setTimeout(()=>c.classList.add("hidden"),300)))}d&&d.addEventListener("click",r=>{r.stopPropagation(),s(!0)}),n&&n.addEventListener("click",()=>s(!1)),c&&c.addEventListener("click",()=>s(!1)),t&&a&&t.addEventListener("click",()=>{s(!1),a.classList.remove("hidden"),a.classList.add("flex");const r=document.getElementById("setBtnAccount");r&&r.click()})}function fe(){const d=document.getElementById("profileDropdownBtn"),i=document.getElementById("profileDropdownMenu"),c=document.getElementById("closeDropdownBtn"),n=document.getElementById("menuSignOutBtn"),t=document.getElementById("dropdownSettingsBtn"),a=document.getElementById("settingsModal");d&&i&&(d.addEventListener("click",s=>{s.stopPropagation(),i.classList.toggle("hidden")}),document.addEventListener("click",s=>{!d.contains(s.target)&&!i.contains(s.target)&&i.classList.add("hidden")})),c&&i&&c.addEventListener("click",s=>{s.stopPropagation(),i.classList.add("hidden")}),n&&n.addEventListener("click",async s=>{s.stopPropagation(),await ie(),window.location.href="/pages/login/"}),t&&a&&t.addEventListener("click",()=>{i.classList.add("hidden"),a.classList.remove("hidden"),a.classList.add("flex");const s=document.getElementById("setBtnAccount");s&&s.click()})}function pe(d){const i=document.getElementById("navProfileImg"),c=document.getElementById("navProfileIcon"),n=document.getElementById("menuProfileImg"),t=document.getElementById("menuProfileIcon"),a=document.getElementById("menuUserName"),s=document.getElementById("menuUserEmail");s&&(s.innerText=d.email);const r=C.settings||{};a&&(a.innerText=r.userFirstName?r.userFirstName:d.displayName?d.displayName.split(" ")[0]:"Student");const f=r.userProfileImage;f?(i&&(i.src=f,i.classList.remove("hidden")),c&&c.classList.add("hidden"),n&&(n.src=f,n.classList.remove("hidden")),t&&t.classList.add("hidden")):(i&&i.classList.add("hidden"),c&&c.classList.remove("hidden"),n&&n.classList.add("hidden"),t&&t.classList.remove("hidden"))}
