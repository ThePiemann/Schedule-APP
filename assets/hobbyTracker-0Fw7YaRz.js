import{o as v,b as x,l as I}from"./auth-cbFyKSDW.js";import{setCurrentUser as L,loadUserData as k,userData as l,saveUserData as y}from"./store-B1XsjTCK.js";let g=null;const B=["wb_sunny","shower","restaurant","fitness_center","menu_book","water_drop","self_care","directions_run","directions_bike","palette","music_note","computer","local_library","self_improvement","nightlight","star","pets","payments","shopping_cart","home"];document.addEventListener("DOMContentLoaded",()=>{console.log("Daily Tracker: Initializing..."),v(x,t=>{t?(L(t),k(()=>{E(t)})):window.location.href="/pages/login/"}),H(),M(),$(),h(),setInterval(h,1e3)});function E(t){A(t),l.hobbyTracker||(l.hobbyTracker={hobbies:[]}),(!l.hobbyTracker.hobbies||l.hobbyTracker.hobbies.length===0)&&!l.hobbyTracker.defaultsAdded&&(l.hobbyTracker.hobbies=[{id:Date.now()+1,name:"Wake Up Early",icon:"wb_sunny",goal:7,logs:[]},{id:Date.now()+2,name:"Morning Shower",icon:"shower",goal:7,logs:[]},{id:Date.now()+3,name:"Healthy Breakfast",icon:"restaurant",goal:7,logs:[]},{id:Date.now()+4,name:"Workout / Exercise",icon:"fitness_center",goal:4,logs:[]},{id:Date.now()+5,name:"Study Session",icon:"menu_book",goal:6,logs:[]}],l.hobbyTracker.defaultsAdded=!0,y()),p()}function p(){const t=document.getElementById("hobbiesContainer");if(!t)return;t.innerHTML="";const o=l.hobbyTracker.hobbies||[];if(o.length===0){t.innerHTML=`
            <div class="lg:col-span-3 text-center py-20 opacity-50">
                <span class="material-symbols-outlined text-6xl mb-4">checklist</span>
                <p class="text-lg font-bold">No daily items tracked yet. Start by adding one!</p>
            </div>`;return}o.forEach(e=>{const s=w(e),i=S(e),a=T(e),n=document.createElement("div");n.className=`bg-card-light dark:bg-card-dark rounded-2xl shadow-sm border ${s?"border-primary":"border-gray-200 dark:border-gray-700"} p-6 flex flex-col hover:shadow-md transition-all duration-300 animate-slide-up group relative`,n.innerHTML=`
            <div class="flex justify-between items-start mb-4">
                <div class="w-12 h-12 ${s?"bg-primary text-white":"bg-primary/10 text-primary"} rounded-xl flex items-center justify-center transition-colors">
                    <span class="material-symbols-outlined text-2xl">${e.icon||"star"}</span>
                </div>
                <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button class="edit-hobby p-1.5 text-gray-400 hover:text-primary transition" data-id="${e.id}">
                        <span class="material-symbols-outlined text-lg">edit</span>
                    </button>
                    <button class="delete-hobby p-1.5 text-gray-400 hover:text-red-500 transition" data-id="${e.id}">
                        <span class="material-symbols-outlined text-lg">delete</span>
                    </button>
                </div>
            </div>
            
            <h3 class="text-xl font-bold mb-1 ${s?"text-primary":""}">${e.name}</h3>
            
            <div class="flex items-center gap-2 mb-6">
                <div class="flex items-center gap-1 text-orange-500 font-bold text-xs">
                    <span class="material-symbols-outlined text-sm">local_fire_department</span>
                    <span>${i} Day Streak</span>
                </div>
                <span class="text-gray-300 dark:text-gray-600">|</span>
                <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">Goal: ${e.goal||7}/week</p>
            </div>

            <div class="flex justify-center gap-3 mb-6">
                ${a.map(c=>`
                    <div class="flex flex-col items-center gap-2">
                        <div class="h-8 w-1.5 rounded-full ${c.completed?"bg-primary":"bg-gray-100 dark:bg-gray-800"}"></div>
                        <span class="text-[10px] font-bold text-gray-400 w-6 text-center">${c.label}</span>
                    </div>
                `).join("")}
            </div>

            <button class="toggle-today w-full py-4 rounded-xl font-bold transition-all duration-300 flex items-center justify-center gap-2 ${s?"bg-primary text-white shadow-lg shadow-primary/30":"bg-gray-100 dark:bg-gray-800 text-gray-500 hover:bg-primary/10 hover:text-primary"}" data-id="${e.id}">
                <span class="material-symbols-outlined text-xl">${s?"check_circle":"circle"}</span>
                ${s?"Completed Today":"Mark as Done"}
            </button>
        `,n.querySelector(".toggle-today").addEventListener("click",()=>D(e.id)),n.querySelector(".edit-hobby").addEventListener("click",()=>f(e)),n.querySelector(".delete-hobby").addEventListener("click",()=>_(e.id)),t.appendChild(n)})}function w(t){if(!t.logs)return!1;const o=new Date().toLocaleDateString();return t.logs.some(e=>new Date(e.date).toLocaleDateString()===o)}function D(t){const o=l.hobbyTracker.hobbies.findIndex(a=>a.id===t);if(o===-1)return;const e=l.hobbyTracker.hobbies[o];e.logs||(e.logs=[]);const s=new Date().toLocaleDateString(),i=e.logs.findIndex(a=>new Date(a.date).toLocaleDateString()===s);if(i!==-1)e.logs.splice(i,1);else{e.logs.push({date:new Date().toISOString()});try{const a=new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");a.volume=.2,a.play()}catch{}}y(),p()}function S(t){if(!t.logs||t.logs.length===0)return 0;const o=t.logs.map(r=>new Date(r.date)).sort((r,m)=>m-r),e=new Date;e.setHours(0,0,0,0);const s=new Date(e);s.setDate(e.getDate()-1);const i=new Date(o[0]);if(i.setHours(0,0,0,0),i<s)return 0;let a=0,n=new Date(i);const c=new Set(o.map(r=>r.toLocaleDateString()));for(;c.has(n.toLocaleDateString());)a++,n.setDate(n.getDate()-1);return a}function T(t){const o=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],e=new Date,s=[];for(let i=6;i>=0;i--){const a=new Date;a.setDate(e.getDate()-i);const n=o[a.getDay()===0?6:a.getDay()-1],c=a.toLocaleDateString(),r=t.logs?t.logs.some(m=>new Date(m.date).toLocaleDateString()===c):!1;s.push({label:n,completed:r})}return s}function H(){const t=document.getElementById("addHobbyBtn"),o=document.getElementById("addHobbyBtnMobile"),e=document.getElementById("hobbyModal"),s=document.getElementById("cancelHobbyBtn"),i=document.getElementById("saveHobbyBtn");t&&t.addEventListener("click",()=>f()),o&&o.addEventListener("click",()=>f()),s&&s.addEventListener("click",()=>{e.classList.add("hidden"),e.classList.remove("flex"),g=null}),i&&i.addEventListener("click",()=>{const a=document.getElementById("hobbyNameInput"),n=document.getElementById("hobbyIconInput"),c=document.getElementById("hobbyGoalInput"),r=a.value.trim(),m=n.value.trim()||"star",b=parseInt(c.value)||7;if(!r){a.focus();return}if(g){const u=l.hobbyTracker.hobbies.findIndex(d=>d.id===g);u!==-1&&(l.hobbyTracker.hobbies[u].name=r,l.hobbyTracker.hobbies[u].icon=m,l.hobbyTracker.hobbies[u].goal=b)}else l.hobbyTracker.hobbies.push({id:Date.now(),name:r,icon:m,goal:b,logs:[]});y(),p(),e.classList.add("hidden"),e.classList.remove("flex"),g=null})}function M(){const t=document.getElementById("iconSelectorGrid");t&&(t.innerHTML="",B.forEach(o=>{const e=document.createElement("button");e.type="button",e.className="icon-select-btn w-10 h-10 flex items-center justify-center rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-primary/10 hover:text-primary transition-all",e.dataset.icon=o,e.innerHTML=`<span class="material-symbols-outlined text-xl">${o}</span>`,e.addEventListener("click",()=>{document.querySelectorAll(".icon-select-btn").forEach(i=>{i.classList.remove("bg-primary","text-white","border-primary"),i.classList.add("border-gray-200","dark:border-gray-700")}),e.classList.add("bg-primary","text-white","border-primary"),e.classList.remove("border-gray-200","dark:border-gray-700");const s=document.getElementById("hobbyIconInput");s&&(s.value=o)}),t.appendChild(e)}))}function f(t=null){const o=document.getElementById("hobbyModal"),e=document.getElementById("hobbyModalTitle"),s=document.getElementById("hobbyNameInput"),i=document.getElementById("hobbyIconInput"),a=document.getElementById("hobbyGoalInput");if(document.querySelectorAll(".icon-select-btn").forEach(n=>{n.classList.remove("bg-primary","text-white","border-primary"),n.classList.add("border-gray-200","dark:border-gray-700")}),t){g=t.id,e.innerText="Edit Daily Item",s.value=t.name,i.value=t.icon,a.value=t.goal;const n=document.querySelector(`.icon-select-btn[data-icon="${t.icon}"]`);n&&(n.classList.add("bg-primary","text-white","border-primary"),n.classList.remove("border-gray-200","dark:border-gray-700"))}else{g=null,e.innerText="Add Daily Item",s.value="",i.value="star",a.value="7";const n=document.querySelector('.icon-select-btn[data-icon="star"]');n&&(n.classList.add("bg-primary","text-white","border-primary"),n.classList.remove("border-gray-200","dark:border-gray-700"))}o.classList.remove("hidden"),o.classList.add("flex")}function _(t){confirm("Are you sure you want to delete this item?")&&(l.hobbyTracker.hobbies=l.hobbyTracker.hobbies.filter(o=>o.id!==t),y(),p())}function h(){const t=document.getElementById("datetimeDisplay");t&&(t.innerText=new Date().toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}function $(){const t=document.getElementById("hamburgerBtn"),o=document.getElementById("appSidebar"),e=document.getElementById("sidebarOverlay"),s=document.getElementById("closeSidebarBtn");function i(d){!o||!e||(d?(o.classList.remove("-translate-x-full"),e.classList.remove("hidden"),setTimeout(()=>e.classList.remove("opacity-0"),10)):(o.classList.add("-translate-x-full"),e.classList.add("opacity-0"),setTimeout(()=>e.classList.add("hidden"),300)))}t&&t.addEventListener("click",d=>{d.stopPropagation(),i(!0)}),s&&s.addEventListener("click",()=>i(!1)),e&&e.addEventListener("click",()=>i(!1));const a=document.getElementById("profileDropdownBtn"),n=document.getElementById("profileDropdownMenu"),c=document.getElementById("closeDropdownBtn"),r=document.getElementById("dropdownSettingsBtn"),m=document.getElementById("settingsModal");a&&n&&(a.addEventListener("click",d=>{d.stopPropagation(),n.classList.toggle("hidden")}),document.addEventListener("click",d=>{!a.contains(d.target)&&!n.contains(d.target)&&n.classList.add("hidden")})),c&&n&&c.addEventListener("click",d=>{d.stopPropagation(),n.classList.add("hidden")}),r&&m&&r.addEventListener("click",()=>{n.classList.add("hidden");const d=document.getElementById("setBtnAccount");d&&d.click(),m.classList.remove("hidden"),m.classList.add("flex")});const b=document.getElementById("sidebarSettingsBtn");b&&m&&b.addEventListener("click",()=>{i(!1);const d=document.getElementById("setBtnAccount");d&&d.click(),m.classList.remove("hidden"),m.classList.add("flex")});const u=document.getElementById("menuSignOutBtn");u&&u.addEventListener("click",async()=>{await I(),window.location.href="/pages/login/"})}function A(t){const o=document.getElementById("menuUserName"),e=document.getElementById("menuUserEmail"),s=document.getElementById("navProfileImg"),i=document.getElementById("navProfileIcon"),a=document.getElementById("menuProfileImg"),n=document.getElementById("menuProfileIcon");e&&(e.innerText=t.email);const c=l.settings||{};o&&(o.innerText=c.userFirstName?c.userFirstName:t.displayName?t.displayName.split(" ")[0]:"Student");const r=c.userProfileImage;r&&(s&&(s.src=r,s.classList.remove("hidden")),i&&i.classList.add("hidden"),a&&(a.src=r,a.classList.remove("hidden")),n&&n.classList.add("hidden"))}
