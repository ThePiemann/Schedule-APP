import{o as j,b as G,l as R}from"./auth-cbFyKSDW.js";import{setCurrentUser as J,loadUserData as K,userData as k,saveUserData as Q}from"./store-C3fFsaMo.js";let r=[],L="#FFFFFF",x=null,E=null,f="#FFFFFF";document.addEventListener("DOMContentLoaded",()=>{j(G,t=>{t?(J(t),K(()=>{X(t)})):window.location.href="/pages/login/"}),te(),ne(),Z()});function X(t){de(t),k.notes||(k.notes=[]),r=k.notes,F()}function N(){k.notes=r,Q()}function F(){const t=document.getElementById("notesGrid"),d=document.getElementById("searchNotes").value.toLowerCase();t.innerHTML="";const i=r.filter(e=>e.title&&e.title.toLowerCase().includes(d)||e.content&&e.content.toLowerCase().includes(d));i.sort((e,n)=>n.pinned===e.pinned?new Date(n.date)-new Date(e.date):n.pinned?1:-1),i.forEach(e=>{const n=document.createElement("div");n.className="note-card bg-white dark:bg-card-dark border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm hover:shadow-md transition group break-inside-avoid relative overflow-hidden cursor-default sm:cursor-pointer",e.pinned&&n.classList.add("border-l-[6px]","border-primary"),n.style.backgroundColor=e.color,document.documentElement.classList.contains("dark")&&(e.color==="#FFFFFF"||e.color==="#F3F4F6")&&(n.style.backgroundColor="");const a="push_pin",o=e.pinned?"text-primary":"text-gray-400 opacity-0 group-hover:opacity-100",l=new Date(e.date).toLocaleDateString(void 0,{month:"short",day:"numeric"});n.innerHTML=`
            <div class="flex justify-between items-start">
                <h3 class="font-bold text-gray-800 dark:text-gray-100 text-lg leading-tight break-words w-full mr-2 min-h-[1.5rem]">${e.title||"(No Title)"}</h3>
                <button class="pin-btn ${o} hover:text-gray-600 dark:hover:text-gray-300 transition p-1 rounded-full z-10" data-id="${e.id}" title="${e.pinned?"Unpin":"Pin"}">
                    <span class="material-symbols-outlined text-xl">${a}</span>
                </button>
            </div>
            <p class="text-[10px] text-gray-400 mt-2 font-medium">${l}</p>
        `,n.addEventListener("click",m=>{m.target.closest("button")||Y(e)}),t.appendChild(n)}),document.querySelectorAll(".pin-btn").forEach(e=>{e.addEventListener("click",n=>{n.stopPropagation();const a=parseInt(e.dataset.id),o=r.find(l=>l.id===a);o&&(o.pinned=!o.pinned,N(),F())})})}function Y(t){E=t.id,f=t.color||"#FFFFFF";const d=document.getElementById("editNoteModal"),i=document.getElementById("editNoteContentWrapper"),e=document.getElementById("editNoteTitle"),n=document.getElementById("editNoteContent"),a=document.getElementById("editPinIcon"),o=document.getElementById("editColorMenu");e.value=t.title,n.innerHTML=t.content,i.style.backgroundColor=f,document.documentElement.classList.contains("dark")&&(f==="#FFFFFF"||f==="#F3F4F6")&&(i.style.backgroundColor=""),t.pinned?i.classList.add("border-l-[6px]","border-primary"):i.classList.remove("border-l-[6px]","border-primary"),a&&(a.innerText="push_pin",t.pinned?(a.parentElement.classList.add("text-primary"),a.parentElement.classList.remove("text-gray-500")):(a.parentElement.classList.remove("text-primary"),a.parentElement.classList.add("text-gray-500"))),o&&o.classList.add("hidden"),d.classList.remove("hidden"),d.classList.add("flex")}function W(){const t=document.getElementById("editNoteModal"),d=document.getElementById("editNoteTitle"),i=document.getElementById("editNoteContent");if(E&&d&&i){const e=d.value.trim(),n=i.innerHTML,a=r.findIndex(o=>o.id===E);if(a>-1){const o=i.innerText.trim();!e&&!o&&!n.includes("<img")?r.splice(a,1):(r[a].title=e,r[a].content=n,r[a].color=f,r[a].date=new Date().toISOString()),N(),F()}}E=null,t.classList.add("hidden"),t.classList.remove("flex")}function _(t){t&&(t.style.height="auto",t.style.height=t.scrollHeight+"px")}function Z(){const t=document.getElementById("createNoteContainer"),d=document.getElementById("createNoteCollapsed"),i=document.getElementById("createNoteExpanded"),e=document.getElementById("newNoteTitle"),n=document.getElementById("newNoteContent"),a=document.getElementById("createNoteBtn"),o=document.getElementById("cancelCreateBtn"),l=document.getElementById("colorPaletteBtn"),m=document.getElementById("colorPaletteMenu"),S=document.getElementById("searchNotes"),v=document.getElementById("editNoteModal"),p=document.getElementById("editNoteContentWrapper"),A=document.getElementById("editNoteTitle"),g=document.getElementById("editNoteContent"),U=document.getElementById("closeEditBtn"),q=document.getElementById("editColorBtn"),b=document.getElementById("editColorMenu"),B=document.getElementById("editPinBtn"),H=document.getElementById("editDeleteBtn"),w=document.getElementById("newNoteToolbar"),T=document.getElementById("editNoteToolbar"),M=(s,c=!1)=>{s&&s.querySelectorAll("button[data-cmd]").forEach(u=>{const h=u.dataset.cmd,V=u.dataset.val;let P=!1;if(!c)try{h==="formatBlock"?P=document.queryCommandValue(h).toLowerCase()===V.toLowerCase():h!=="removeFormat"&&(P=document.queryCommandState(h))}catch{}P?(u.classList.add("text-primary","bg-primary/10"),u.classList.remove("text-gray-500","hover:bg-gray-100","dark:hover:bg-gray-700")):(u.classList.remove("text-primary","bg-primary/10"),u.classList.add("text-gray-500","hover:bg-gray-100","dark:hover:bg-gray-700"))})},y=()=>{setTimeout(()=>{n&&document.activeElement===n&&M(w),g&&document.activeElement===g&&M(T)},0)},C=(s,c)=>{s&&(c?s.classList.remove("opacity-50","pointer-events-none"):(s.classList.add("opacity-50","pointer-events-none"),M(s,!0)))};n&&(n.addEventListener("input",()=>{_(n),y()}),n.addEventListener("keyup",y),n.addEventListener("mouseup",y),n.addEventListener("focus",()=>C(w,!0))),g&&(g.addEventListener("input",()=>{_(g),y()}),g.addEventListener("keyup",y),g.addEventListener("mouseup",y),g.addEventListener("focus",()=>C(T,!0))),e&&e.addEventListener("focus",()=>C(w,!1)),A&&A.addEventListener("focus",()=>C(T,!1)),document.querySelectorAll("[data-cmd]").forEach(s=>{s.addEventListener("mousedown",c=>c.preventDefault()),s.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation();const u=s.dataset.cmd,h=s.dataset.val||null;u==="removeFormat"?document.execCommand("removeFormat",!1,null):document.execCommand(u,!1,h),y()})}),d&&i&&e&&d.addEventListener("click",()=>{d.classList.add("hidden"),i.classList.remove("hidden"),e.focus()});const D=()=>{e&&(e.value=""),n&&(n.innerHTML=""),L="#FFFFFF",t&&(t.style.backgroundColor="",document.documentElement.classList.contains("dark")&&(t.style.backgroundColor="")),i&&i.classList.add("hidden"),d&&d.classList.remove("hidden"),m&&m.classList.add("hidden")},z=()=>{const s=e?e.value.trim():"",c=n?n.innerHTML:"",u=n?n.innerText.trim():"";(s||u||c.includes("<img"))&&(r.unshift({id:Date.now(),title:s,content:c,color:L,pinned:!1,date:new Date().toISOString()}),N(),F()),D()};a&&a.addEventListener("click",z),o&&o.addEventListener("click",D),l&&m&&l.addEventListener("click",s=>{s.stopPropagation(),m.classList.toggle("hidden")}),document.querySelectorAll(".color-option").forEach(s=>{s.addEventListener("click",c=>{c.stopPropagation(),L=s.dataset.color,t&&(t.style.backgroundColor=L),document.documentElement.classList.contains("dark")&&(L==="#FFFFFF"||L==="#F3F4F6")?t&&(t.style.backgroundColor=""):L!=="#FFFFFF"&&t&&t.classList.add("text-gray-800"),m&&m.classList.add("hidden")})}),S&&S.addEventListener("input",F),v&&(v.addEventListener("click",s=>{s.target===v&&W()}),U&&U.addEventListener("click",W),q&&b&&q.addEventListener("click",s=>{s.stopPropagation(),b.classList.toggle("hidden")}),document.querySelectorAll(".edit-color-option").forEach(s=>{s.addEventListener("click",c=>{c.stopPropagation(),f=s.dataset.color,p&&(p.style.backgroundColor=f,document.documentElement.classList.contains("dark")&&(f==="#FFFFFF"||f==="#F3F4F6")&&(p.style.backgroundColor="")),b&&b.classList.add("hidden")})}),B&&B.addEventListener("click",()=>{const s=r.find(c=>c.id===E);if(s){s.pinned=!s.pinned;const c=document.getElementById("editPinIcon");c&&(c.innerText="push_pin"),s.pinned?(B.classList.add("text-primary"),B.classList.remove("text-gray-500"),p&&p.classList.add("border-l-[6px]","border-primary")):(B.classList.remove("text-primary"),B.classList.add("text-gray-500"),p&&p.classList.remove("border-l-[6px]","border-primary"))}}),H&&H.addEventListener("click",()=>{ee(E),v&&(v.classList.add("hidden"),v.classList.remove("flex")),E=null}));const I=document.getElementById("deleteModal"),O=document.getElementById("confirmDeleteBtn"),$=document.getElementById("cancelDeleteBtn");O&&O.addEventListener("click",()=>{x&&(r=r.filter(s=>s.id!==x),N(),F()),I&&(I.classList.add("hidden"),I.classList.remove("flex")),x=null}),$&&$.addEventListener("click",()=>{I&&(I.classList.add("hidden"),I.classList.remove("flex")),x=null})}function ee(t){x=t;const d=document.getElementById("deleteModal");d&&(d.classList.remove("hidden"),d.classList.add("flex"))}function te(){const t=document.getElementById("hamburgerBtn"),d=document.getElementById("appSidebar"),i=document.getElementById("sidebarOverlay"),e=document.getElementById("closeSidebarBtn"),n=document.getElementById("sidebarSettingsBtn"),a=document.getElementById("settingsModal");function o(l){!d||!i||(l?(d.classList.remove("-translate-x-full"),i.classList.remove("hidden"),setTimeout(()=>i.classList.remove("opacity-0"),10)):(d.classList.add("-translate-x-full"),i.classList.add("opacity-0"),setTimeout(()=>i.classList.add("hidden"),300)))}t&&t.addEventListener("click",l=>{l.stopPropagation(),o(!0)}),e&&e.addEventListener("click",()=>o(!1)),i&&i.addEventListener("click",()=>o(!1)),n&&a&&n.addEventListener("click",()=>{o(!1),a.classList.remove("hidden"),a.classList.add("flex");const l=document.getElementById("setBtnAccount");l&&l.click()})}function ne(){const t=document.getElementById("profileDropdownBtn"),d=document.getElementById("profileDropdownMenu"),i=document.getElementById("closeDropdownBtn"),e=document.getElementById("menuSignOutBtn"),n=document.getElementById("dropdownSettingsBtn"),a=document.getElementById("settingsModal");t&&d&&(t.addEventListener("click",o=>{o.stopPropagation(),d.classList.toggle("hidden")}),document.addEventListener("click",o=>{!t.contains(o.target)&&!d.contains(o.target)&&d.classList.add("hidden")})),i&&d&&i.addEventListener("click",o=>{o.stopPropagation(),d.classList.add("hidden")}),e&&e.addEventListener("click",async o=>{o.stopPropagation(),await R(),window.location.href="/pages/login/"}),n&&a&&n.addEventListener("click",()=>{d.classList.add("hidden"),a.classList.remove("hidden"),a.classList.add("flex");const o=document.getElementById("setBtnAccount");o&&o.click()})}function de(t){const d=document.getElementById("navProfileImg"),i=document.getElementById("navProfileIcon"),e=document.getElementById("menuProfileImg"),n=document.getElementById("menuProfileIcon"),a=document.getElementById("menuUserName"),o=document.getElementById("menuUserEmail");o&&(o.innerText=t.email);const l=k.settings||{};a&&(a.innerText=l.userFirstName?l.userFirstName:t.displayName||"Student");const m=l.userProfileImage;m?(d&&(d.src=m,d.classList.remove("hidden")),i&&i.classList.add("hidden"),e&&(e.src=m,e.classList.remove("hidden")),n&&n.classList.add("hidden")):(d&&d.classList.add("hidden"),i&&i.classList.remove("hidden"),e&&e.classList.add("hidden"),n&&n.classList.remove("hidden"))}
