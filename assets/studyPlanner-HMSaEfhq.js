import{o as $,b as P,l as N}from"./auth-cbFyKSDW.js";import{setCurrentUser as C,loadUserData as A,userData as l,saveUserData as b}from"./store-B-09Ib52.js";let p=null,c=1500,y="pomodoro",h=[],v=new Date().getDay()===0?6:new Date().getDay()-1,g=null;document.addEventListener("DOMContentLoaded",()=>{$(P,e=>{e?(C(e),A(()=>{U(e)})):window.location.href="/pages/login/"}),J(),H(),G(),F(),O(),window.addEventListener("settingsChanged",()=>{p||T()}),M(),setInterval(M,1e3)});function U(e){Q(e),l.studyPlanner||(l.studyPlanner={goals:[],notes:""}),h=l.studyPlanner.goals||[],document.getElementById("studyQuickNotes").value=l.studyPlanner.notes||"",B(),S()}function S(){const e=document.getElementById("studyDailyOverview");if(!e)return;e.innerHTML="";const n=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];document.querySelectorAll(".day-filter-btn").forEach(t=>{parseInt(t.dataset.day)===v?(t.classList.add("bg-primary","text-white"),t.classList.remove("text-gray-500","hover:bg-gray-100","dark:hover:bg-gray-800")):(t.classList.remove("bg-primary","text-white"),t.classList.add("text-gray-500","hover:bg-gray-100","dark:hover:bg-gray-800"))});let s=[];for(let t=0;t<=23;t++){const o=l.studySchedule[`study-schedule-${v}-${t}`];if(o)try{const a=typeof o=="string"?JSON.parse(o):o;s.push({h:t,data:a})}catch(a){console.error("Parse error study session:",a)}}s.length>0?s.forEach(t=>{const o=document.createElement("div");o.className="flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-100 dark:border-gray-700/50 transition hover:shadow-sm animate-pop-in group relative overflow-hidden",o.innerHTML=`
                <div class="absolute left-0 top-0 bottom-0 w-1.5" style="background-color: ${t.data.color||"#4A90E2"}"></div>
                <div class="flex-1 py-1 pl-1">
                    <p class="text-sm font-bold text-gray-800 dark:text-gray-200 leading-tight">${t.data.subject}</p>
                    <p class="text-[10px] text-gray-500 font-medium mt-1">${t.data.start} - ${t.data.end}</p>
                </div>
                <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button class="edit-study-session text-gray-400 hover:text-primary transition p-1" data-hour="${t.h}" data-day="${v}">
                        <span class="material-symbols-outlined text-base">edit</span>
                    </button>
                    <button class="delete-study-session text-gray-400 hover:text-red-500 transition p-1" data-hour="${t.h}" data-day="${v}">
                        <span class="material-symbols-outlined text-base">delete</span>
                    </button>
                </div>
            `,e.appendChild(o)}):e.innerHTML=`
            <div class="text-center py-8 opacity-50 bg-gray-50 dark:bg-gray-800/30 rounded-2xl border-2 border-dashed border-gray-200 dark:border-gray-700">
                <span class="material-symbols-outlined text-3xl mb-2 text-gray-400">event_busy</span>
                <p class="text-xs font-bold">No sessions for ${n[v]}.</p>
            </div>`,e.querySelectorAll(".delete-study-session").forEach(t=>{t.addEventListener("click",o=>{o.stopPropagation();const a=t.dataset.hour,r=t.dataset.day;delete l.studySchedule[`study-schedule-${r}-${a}`],b(),S()})}),e.querySelectorAll(".edit-study-session").forEach(t=>{t.addEventListener("click",o=>{o.stopPropagation();const a=t.dataset.hour,r=t.dataset.day,i=`study-schedule-${r}-${a}`,d=l.studySchedule[i];if(d){const m=typeof d=="string"?JSON.parse(d):d;q(m,i,r)}})})}function q(e,n,s){g=n;const t=document.getElementById("eventModal");document.getElementById("eventInput").value=e.subject,document.getElementById("eventDayInput").value=s,document.getElementById("startTimeInput").value=e.start,document.getElementById("endTimeInput").value=e.end,document.getElementById("selectedColorInput").value=e.color,document.querySelectorAll(".color-btn").forEach(a=>{a.classList.remove("ring-offset-2","ring-gray-400","scale-110"),a.classList.add("ring-transparent"),a.dataset.color===e.color&&(a.classList.remove("ring-transparent"),a.classList.add("ring-offset-2","ring-gray-400","scale-110"))});const o=t.querySelector("h3");o&&(o.innerText="Edit Study Session"),t.classList.remove("hidden"),t.classList.add("flex")}function O(){document.querySelectorAll(".day-filter-btn").forEach(e=>{e.addEventListener("click",()=>{v=parseInt(e.dataset.day),S()})})}function L(){l.studyPlanner={goals:h,notes:document.getElementById("studyQuickNotes").value},b()}function M(){const e=document.getElementById("datetimeDisplay");e&&(e.innerText=new Date().toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}function H(){const e=document.getElementById("startTimerBtn"),n=document.getElementById("pauseTimerBtn"),s=document.getElementById("resetTimerBtn"),t=document.getElementById("pomodoroMode"),o=document.getElementById("shortBreakMode"),a=document.getElementById("longBreakMode"),r=document.getElementById("customMode");e.addEventListener("click",()=>{j(),e.classList.add("hidden"),n.classList.remove("hidden")}),n.addEventListener("click",()=>{k(),n.classList.add("hidden"),e.classList.remove("hidden")}),s.addEventListener("click",()=>{T(),n.classList.add("hidden"),e.classList.remove("hidden")}),t.addEventListener("click",()=>E("pomodoro")),o.addEventListener("click",()=>E("short")),a.addEventListener("click",()=>E("long")),r&&r.addEventListener("click",()=>{const i=document.getElementById("customTimerModal");i&&(i.classList.remove("hidden"),i.classList.add("flex"))}),document.getElementById("closeCustomTimerBtn")?.addEventListener("click",()=>{const i=document.getElementById("customTimerModal");i.classList.add("hidden"),i.classList.remove("flex")}),document.getElementById("applyCustomTimerBtn")?.addEventListener("click",()=>{const i=document.getElementById("customHoursInput"),d=document.getElementById("customMinutesInput"),m=document.getElementById("customSecondsInput"),u=parseInt(i.value)||0,f=parseInt(d.value)||0,x=parseInt(m.value)||0,I=u*3600+f*60+x;if(I>0){E("custom",I);const D=document.getElementById("customTimerModal");D.classList.add("hidden"),D.classList.remove("flex")}})}function E(e,n=null){y=e,k();const s={pomodoro:"pomodoroMode",short:"shortBreakMode",long:"longBreakMode",custom:"customMode"};Object.values(s).forEach(o=>{const a=document.getElementById(o);a&&(a.classList.remove("bg-white","dark:bg-gray-700","shadow-sm"),a.classList.add("text-gray-500"))});const t=document.getElementById(s[e]);if(t&&(t.classList.add("bg-white","dark:bg-gray-700","shadow-sm"),t.classList.remove("text-gray-500")),e==="custom"&&n!==null)c=n,l.studyPlanner.lastCustomSeconds=n;else{const o=l.settings||{};e==="pomodoro"?c=(parseInt(o.pomoDuration)||25)*60:e==="short"?c=(parseInt(o.shortDuration)||5)*60:e==="long"&&(c=(parseInt(o.longDuration)||15)*60)}w(),document.getElementById("startTimerBtn").classList.remove("hidden"),document.getElementById("pauseTimerBtn").classList.add("hidden")}function j(){p||(p=setInterval(()=>{if(c--,w(),c<=0){clearInterval(p),p=null,document.getElementById("startTimerBtn").classList.remove("hidden"),document.getElementById("pauseTimerBtn").classList.add("hidden");try{new Audio("https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg").play()}catch{}const e=document.getElementById("timesUpModal");e&&(e.classList.remove("hidden"),e.classList.add("flex")),T()}},1e3))}document.getElementById("closeTimesUpBtn")?.addEventListener("click",()=>{const e=document.getElementById("timesUpModal");e.classList.add("hidden"),e.classList.remove("flex")});function k(){clearInterval(p),p=null}function T(){k();const e=l.settings||{};y==="custom"?c=l.studyPlanner.lastCustomSeconds||1500:y==="pomodoro"?c=(parseInt(e.pomoDuration)||25)*60:y==="short"?c=(parseInt(e.shortDuration)||5)*60:y==="long"&&(c=(parseInt(e.longDuration)||15)*60),w()}function w(){const e=Math.floor(c/3600),n=Math.floor(c%3600/60),s=c%60;let t;e>0?t=`${e}:${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:t=`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`,document.getElementById("timerDisplay").innerText=t;const o=document.getElementById("timerProgress"),a=l.settings||{};let r;y==="custom"?r=l.studyPlanner.lastCustomSeconds||1500:r=y==="pomodoro"?(parseInt(a.pomoDuration)||25)*60:y==="short"?(parseInt(a.shortDuration)||5)*60:(parseInt(a.longDuration)||15)*60;const i=Math.max(0,c/r),d=2*Math.PI*88;o.style.strokeDashoffset=d*(1-i)}function G(){const e=document.getElementById("addStudyGoalBtn"),n=document.getElementById("studyGoalInput"),s=document.getElementById("studyQuickNotes");e.addEventListener("click",()=>{const t=n.value.trim();t&&(h.push({id:Date.now(),text:t,completed:!1}),n.value="",B(),L())}),n.addEventListener("keypress",t=>{t.key==="Enter"&&e.click()}),s.addEventListener("input",()=>{clearTimeout(s.timeout),s.timeout=setTimeout(L,1e3)})}function B(){const e=document.getElementById("studyGoalsList");e.innerHTML="",h.forEach(n=>{const s=document.createElement("div");s.className="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-100 dark:border-gray-700/50 group transition-all",n.completed&&s.classList.add("opacity-60"),s.innerHTML=`
            <div class="flex items-center gap-3">
                <button class="goal-toggle w-6 h-6 rounded-full border-2 ${n.completed?"bg-primary border-primary text-white":"border-gray-300 dark:border-gray-600"} flex items-center justify-center transition">
                    ${n.completed?'<span class="material-symbols-outlined text-sm">check</span>':""}
                </button>
                <span class="text-sm font-medium ${n.completed?"line-through text-gray-400":""}">${n.text}</span>
            </div>
            <button class="goal-delete opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 transition p-1">
                <span class="material-symbols-outlined text-lg">delete</span>
            </button>
        `,s.querySelector(".goal-toggle").addEventListener("click",()=>{n.completed=!n.completed,B(),L()}),s.querySelector(".goal-delete").addEventListener("click",()=>{h=h.filter(t=>t.id!==n.id),B(),L()}),e.appendChild(s)})}function F(){const e=document.getElementById("addToScheduleBtn"),n=document.getElementById("eventModal"),s=document.getElementById("closeEventModal"),t=document.getElementById("saveEventBtn"),o=document.getElementById("eventInput"),a=document.getElementById("eventDayInput"),r=document.getElementById("startTimeInput"),i=document.getElementById("endTimeInput"),d=document.getElementById("selectedColorInput");e&&n&&e.addEventListener("click",()=>{g=null;const m=n.querySelector("h3");m&&(m.innerText="Add Study Time to Schedule");const u=new Date;r.value=`${u.getHours().toString().padStart(2,"0")}:00`,i.value=`${(u.getHours()+1).toString().padStart(2,"0")}:00`,a.value=u.getDay()===0?6:u.getDay()-1,n.classList.remove("hidden"),n.classList.add("flex")}),s&&s.addEventListener("click",()=>{g=null,n.classList.add("hidden"),n.classList.remove("flex")}),t&&t.addEventListener("click",()=>{const m=o.value.trim()||"Study Session",u=a.value,f=parseInt(r.value.split(":")[0]),x={subject:m,start:r.value,end:i.value,location:"",type:"Study",teacher:"",color:d.value,weekType:"every"},I=`study-schedule-${u}-${f}`;g&&g!==I&&delete l.studySchedule[g],l.studySchedule[I]=JSON.stringify(x),b(),g=null,n.classList.add("hidden"),n.classList.remove("flex"),setTimeout(()=>S(),100),typeof showConfirmationModal=="function"&&showConfirmationModal("Updated!","Your study session has been saved.",()=>{},!1)}),document.querySelectorAll(".color-btn").forEach(m=>{m.addEventListener("click",u=>{document.querySelectorAll(".color-btn").forEach(f=>{f.classList.remove("ring-offset-2","ring-gray-400","scale-110"),f.classList.add("ring-transparent")}),u.target.classList.remove("ring-transparent"),u.target.classList.add("ring-offset-2","ring-gray-400","scale-110"),d.value=u.target.dataset.color})})}function J(){const e=document.getElementById("hamburgerBtn"),n=document.getElementById("appSidebar"),s=document.getElementById("sidebarOverlay"),t=document.getElementById("closeSidebarBtn");function o(d){!n||!s||(d?(n.classList.remove("-translate-x-full"),s.classList.remove("hidden"),setTimeout(()=>s.classList.remove("opacity-0"),10)):(n.classList.add("-translate-x-full"),s.classList.add("opacity-0"),setTimeout(()=>s.classList.add("hidden"),300)))}e&&e.addEventListener("click",d=>{d.stopPropagation(),o(!0)}),t&&t.addEventListener("click",()=>o(!1)),s&&s.addEventListener("click",()=>o(!1));const a=document.getElementById("profileDropdownBtn"),r=document.getElementById("profileDropdownMenu");a&&r&&(a.addEventListener("click",d=>{d.stopPropagation(),r.classList.toggle("hidden")}),document.addEventListener("click",d=>{!a.contains(d.target)&&!r.contains(d.target)&&r.classList.add("hidden")}));const i=document.getElementById("menuSignOutBtn");i&&i.addEventListener("click",async()=>{await N(),window.location.href="/pages/login/"})}function Q(e){const n=document.getElementById("menuUserName"),s=document.getElementById("menuUserEmail"),t=document.getElementById("navProfileImg"),o=document.getElementById("navProfileIcon"),a=document.getElementById("menuProfileImg"),r=document.getElementById("menuProfileIcon");s&&(s.innerText=e.email);const i=l.settings||{};n&&(n.innerText=i.userFirstName?i.userFirstName:e.displayName?e.displayName.split(" ")[0]:"Student");const d=i.userProfileImage;d&&(t&&(t.src=d,t.classList.remove("hidden")),o&&o.classList.add("hidden"),a&&(a.src=d,a.classList.remove("hidden")),r&&r.classList.add("hidden"))}
