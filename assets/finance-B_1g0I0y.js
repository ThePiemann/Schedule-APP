import{o as V,b as W,l as X}from"./auth-cbFyKSDW.js";import{setCurrentUser as Y,loadUserData as Z,userData as p,saveUserData as ee}from"./store-B-09Ib52.js";document.addEventListener("DOMContentLoaded",()=>{V(W,e=>{e?(Y(e),Z(()=>{te(e)})):window.location.href="/pages/login/"}),ce(),re(),oe(),le()});let f=[],x=[],h=[],E=[],I=100,M=null;function te(e){me(e),p.finance||(p.finance={transactions:[],subscriptions:[],debts:[],goals:[],budget:100}),f=p.finance.transactions||[],x=p.finance.subscriptions||[],h=p.finance.debts||[],E=p.finance.goals||[],I=parseFloat(p.finance.budget)||100,v()}function y(){p.finance={transactions:f,subscriptions:x,debts:h,goals:E,budget:I},ee(),localStorage.setItem("studentDash_finance",JSON.stringify(p.finance))}const R=localStorage.getItem("studentDash_finance");R&&JSON.parse(R);function v(){z(),ne(),se(),ae(),de()}function z(){const e=document.getElementById("totalBalanceDisplay"),t=document.getElementById("monthlySpentDisplay"),n=document.getElementById("recurringTotalDisplay"),a=document.getElementById("budgetProgressBar"),o=document.getElementById("monthlyBudgetDisplay");let d=0,s=0,l=0;const g=new Date().getMonth();f.forEach(m=>{const L=parseFloat(m.amount);m.type==="income"?d+=L:(s+=L,new Date(m.date).getMonth()===g&&(l+=L))});const B=d-s;e.innerText=r(B),t.innerText=r(l);let D=0;x.forEach(m=>D+=parseFloat(m.cost)),n.innerText=r(D);const b=Math.min(l/I*100,100);a.style.width=`${b}%`,o&&(o.innerText=r(I));const T=t.closest(".group");if(T){const m=T.querySelector("p.italic");m&&(m.innerText=`* Percentage of your ${r(I)} monthly limit`)}B<0?e.classList.add("text-red-500"):e.classList.remove("text-red-500")}function ne(){const e=document.getElementById("transactionList");if(e.innerHTML="",f.length===0){e.innerHTML=`
            <div class="text-center py-10 opacity-50">
                <span class="material-symbols-outlined text-4xl mb-2">receipt_long</span>
                <p class="text-sm font-bold">No transactions yet.</p>
            </div>`;return}[...f].sort((n,a)=>new Date(a.date)-new Date(n.date)).forEach(n=>{const a=document.createElement("div");a.className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700 transition group";const o=n.type==="expense",d=ie(n.category),s=o?"text-red-500":"text-green-500",l=o?"-":"+";a.innerHTML=`
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full ${o?"bg-red-100 text-red-500":"bg-green-100 text-green-500"} flex items-center justify-center">
                    <span class="material-symbols-outlined text-xl">${d}</span>
                </div>
                <div>
                    <h4 class="text-sm font-bold text-gray-800 dark:text-white">${n.description}</h4>
                    <p class="text-[10px] text-gray-500 font-medium">${new Date(n.date).toLocaleDateString()}</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span class="font-bold ${s}">${l}${r(n.amount)}</span>
                <button class="delete-trans-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${n.id}" title="Delete Transaction">
                    <span class="material-symbols-outlined text-lg">delete</span>
                </button>
            </div>
        `,e.appendChild(a)}),document.querySelectorAll(".delete-trans-btn").forEach(n=>{n.addEventListener("click",a=>{O(()=>{const o=parseInt(n.dataset.id);f=f.filter(d=>d.id!==o),y(),v()})})})}function se(){const e=document.getElementById("subscriptionList");if(e.innerHTML="",x.length===0){e.innerHTML='<p class="text-xs text-gray-400 text-center py-4">No subscriptions added.</p>';return}x.forEach(t=>{const n=document.createElement("div");n.className="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded border border-gray-100 dark:border-gray-700/50 group",n.innerHTML=`
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                    <span class="text-xs font-bold text-gray-600 dark:text-gray-300">${t.name.charAt(0)}</span>
                </div>
                <div>
                    <p class="text-xs font-bold text-gray-800 dark:text-gray-200">${t.name}</p>
                    <p class="text-[10px] text-gray-400">Due day ${t.day}</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-xs font-bold text-gray-700 dark:text-gray-300">${r(t.cost)}</span>
                <button class="delete-sub-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${t.id}" title="Delete Subscription">
                    <span class="material-symbols-outlined text-lg">delete</span>
                </button>
            </div>
        `,e.appendChild(n)}),document.querySelectorAll(".delete-sub-btn").forEach(t=>{t.addEventListener("click",n=>{O(()=>{const a=parseInt(t.dataset.id);x=x.filter(o=>o.id!==a),y(),v()})})})}function ae(){const e=document.getElementById("debtList"),t=document.getElementById("totalOweDisplay"),n=document.getElementById("totalOwedDisplay");e.innerHTML="";let a=0,o=0;h.length===0?e.innerHTML='<p class="text-xs text-gray-400 text-center py-2">No debts recorded.</p>':(h.forEach(d=>{const s=parseFloat(d.amount);d.type==="owe_them"?a+=s:o+=s;const l=document.createElement("div");l.className="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded border border-gray-100 dark:border-gray-700/50 group";const i=d.type==="owe_them",g=i?"text-red-500":"text-green-500",B=i?"arrow_outward":"south_west";l.innerHTML=`
                <div class="flex items-center gap-2 overflow-hidden">
                    <div class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-700 flex items-center justify-center shrink-0">
                        <span class="material-symbols-outlined text-sm ${g}">${B}</span>
                    </div>
                    <div class="truncate">
                        <p class="text-xs font-bold text-gray-800 dark:text-gray-200 truncate">${d.person}</p>
                        <p class="text-[10px] text-gray-400 truncate">${d.description||"Debt"}</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs font-bold ${g}">${r(s)}</span>
                    <button class="delete-debt-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${d.id}">
                        <span class="material-symbols-outlined text-lg">delete</span>
                    </button>
                </div>
            `,e.appendChild(l)}),document.querySelectorAll(".delete-debt-btn").forEach(d=>{d.addEventListener("click",s=>{O(()=>{const l=parseInt(d.dataset.id);h=h.filter(i=>i.id!==l),y(),v()})})})),t.innerText=r(a),n.innerText=r(o)}function de(){const e=document.getElementById("goalsList");if(e.innerHTML="",E.length===0){e.innerHTML='<p class="text-xs text-gray-400 text-center py-2">No goals set.</p>';return}let t=0;f.forEach(n=>{const a=parseFloat(n.amount);n.type==="income"?t+=a:t-=a}),E.forEach(n=>{const a=parseFloat(n.target),o=Math.min(t/a*100,100),d=t>=a,s=document.createElement("div");s.className="group",s.innerHTML=`
            <div class="flex justify-between items-end mb-1">
                <h4 class="text-sm font-bold text-gray-700 dark:text-gray-300">${n.name}</h4>
                <div class="flex items-center gap-2">
                    <span class="text-xs font-bold ${d?"text-green-500":"text-gray-500"}">
                        ${d?"Affordable!":`${Math.floor(o)}%`}
                    </span>
                    <button class="delete-goal-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${n.id}">
                        <span class="material-symbols-outlined text-lg">delete</span>
                    </button>
                </div>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 h-2 rounded-full overflow-hidden">
                <div class="h-full rounded-full transition-all duration-500 ${d?"bg-green-500":"bg-primary"}" style="width: ${Math.max(0,o)}%"></div>
            </div>
            <p class="text-[10px] text-gray-400 mt-1 text-right">${r(a)} Target</p>
        `,e.appendChild(s)}),document.querySelectorAll(".delete-goal-btn").forEach(n=>{n.addEventListener("click",()=>{O(()=>{const a=parseInt(n.dataset.id);E=E.filter(o=>o.id!==a),y(),v()})})})}function oe(){const e=document.getElementById("transactionModal"),t=document.getElementById("addTransactionBtn"),n=document.getElementById("cancelTransBtn"),a=document.getElementById("saveTransBtn"),o=document.getElementById("subModal"),d=document.getElementById("addSubBtn"),s=document.getElementById("cancelSubBtn"),l=document.getElementById("saveSubBtn"),i=document.getElementById("debtModal"),g=document.getElementById("addDebtBtn"),B=document.getElementById("cancelDebtBtn"),D=document.getElementById("saveDebtBtn"),b=document.getElementById("goalModal"),T=document.getElementById("addGoalBtn"),m=document.getElementById("cancelGoalBtn"),L=document.getElementById("saveGoalBtn"),S=document.getElementById("typeOweThemBtn"),$=document.getElementById("typeOweMeBtn"),P=document.getElementById("debtTypeInput"),w=document.getElementById("budgetModal"),j=document.getElementById("editBudgetBtn"),U=document.getElementById("cancelBudgetBtn"),G=document.getElementById("saveBudgetBtn");j&&j.addEventListener("click",()=>{document.getElementById("budgetInput").value=I,w.classList.remove("hidden"),w.classList.add("flex")}),U&&U.addEventListener("click",()=>{w.classList.add("hidden"),w.classList.remove("flex")}),G&&G.addEventListener("click",()=>{const c=parseFloat(document.getElementById("budgetInput").value);c>0&&(I=c,y(),z(),w.classList.add("hidden"),w.classList.remove("flex"))}),g&&g.addEventListener("click",()=>{i.classList.remove("hidden"),i.classList.add("flex")}),B&&B.addEventListener("click",()=>{i.classList.add("hidden"),i.classList.remove("flex")}),S&&S.addEventListener("click",()=>{P.value="owe_them",S.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-red-500 transition",$.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition"}),$&&$.addEventListener("click",()=>{P.value="owe_me",$.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-green-500 transition",S.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition"}),D&&D.addEventListener("click",()=>{const c=document.getElementById("debtPersonInput").value,u=document.getElementById("debtAmountInput").value,k=document.getElementById("debtDescInput").value,H=P.value;if(!c||!u)return alert("Please fill in person and amount");h.push({id:Date.now(),person:c,amount:parseFloat(u),description:k,type:H,date:new Date().toISOString()}),y(),v(),document.getElementById("debtPersonInput").value="",document.getElementById("debtAmountInput").value="",document.getElementById("debtDescInput").value="",i.classList.add("hidden"),i.classList.remove("flex")}),T&&T.addEventListener("click",()=>{b.classList.remove("hidden"),b.classList.add("flex")}),m&&m.addEventListener("click",()=>{b.classList.add("hidden"),b.classList.remove("flex")}),L&&L.addEventListener("click",()=>{const c=document.getElementById("goalNameInput").value,u=document.getElementById("goalTargetInput").value;!c||!u||(E.push({id:Date.now(),name:c,target:parseFloat(u)}),y(),v(),document.getElementById("goalNameInput").value="",document.getElementById("goalTargetInput").value="",b.classList.add("hidden"),b.classList.remove("flex"))});const N=document.getElementById("deleteModal"),q=document.getElementById("confirmDeleteBtn"),J=document.getElementById("cancelDeleteBtn");q&&q.addEventListener("click",()=>{M&&M(),N.classList.add("hidden"),N.classList.remove("flex"),M=null}),J&&J.addEventListener("click",()=>{N.classList.add("hidden"),N.classList.remove("flex"),M=null});const F=document.getElementById("typeExpenseBtn"),C=document.getElementById("typeIncomeBtn"),A=document.getElementById("transTypeInput"),K=document.getElementById("transCategoryInput");t&&t.addEventListener("click",()=>{_("expense"),e.classList.remove("hidden"),e.classList.add("flex")}),n&&n.addEventListener("click",()=>{e.classList.add("hidden"),e.classList.remove("flex")}),F&&F.addEventListener("click",()=>{A.value="expense",F.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-red-500 transition",C.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition",_("expense")}),C&&C.addEventListener("click",()=>{A.value="income",C.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-green-500 transition",F.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition",_("income")}),a&&a.addEventListener("click",()=>{const c=document.getElementById("transAmountInput").value,u=document.getElementById("transDescInput").value,k=K.value,H=A.value;if(!c||!u)return alert("Please fill in amount and description");const Q={id:Date.now(),type:H,amount:parseFloat(c),category:k,description:u,date:new Date().toISOString()};f.unshift(Q),y(),v(),document.getElementById("transAmountInput").value="",document.getElementById("transDescInput").value="",e.classList.add("hidden"),e.classList.remove("flex")}),d&&d.addEventListener("click",()=>{o.classList.remove("hidden"),o.classList.add("flex")}),s&&s.addEventListener("click",()=>{o.classList.add("hidden"),o.classList.remove("flex")}),l&&l.addEventListener("click",()=>{const c=document.getElementById("subNameInput").value,u=document.getElementById("subCostInput").value,k=document.getElementById("subDayInput").value;!c||!u||!k||(x.push({id:Date.now(),name:c,cost:parseFloat(u),day:parseInt(k)}),y(),v(),document.getElementById("subNameInput").value="",document.getElementById("subCostInput").value="",document.getElementById("subDayInput").value="",o.classList.add("hidden"),o.classList.remove("flex"))})}function _(e){const t=document.getElementById("transCategoryInput");t.innerHTML="",(e==="expense"?[{val:"food",label:"Food & Dining"},{val:"transport",label:"Transportation"},{val:"school",label:"School Supplies"},{val:"entertainment",label:"Entertainment"},{val:"shopping",label:"Shopping"},{val:"other",label:"Other"}]:[{val:"allowance",label:"Allowance"},{val:"job",label:"Part-time Job"},{val:"aid",label:"Financial Aid"},{val:"other",label:"Other"}]).forEach(d=>{const s=document.createElement("option");s.value=d.val,s.innerText=d.label,t.appendChild(s)})}function le(){const e=document.getElementById("splitTotal"),t=document.getElementById("splitPeople"),n=document.getElementById("splitResult");function a(){const o=parseFloat(e.value)||0,d=parseInt(t.value)||1;if(d<1)return;const s=o/d;n.innerText=r(s)}e&&t&&(e.addEventListener("input",a),t.addEventListener("input",a))}function O(e){M=e;const t=document.getElementById("deleteModal");t.classList.remove("hidden"),t.classList.add("flex")}function r(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}function ie(e){return{food:"fastfood",transport:"directions_bus",school:"school",entertainment:"movie",shopping:"shopping_bag",allowance:"savings",job:"work",aid:"volunteer_activism",other:"category"}[e]||"category"}function ce(){const e=document.getElementById("hamburgerBtn"),t=document.getElementById("appSidebar"),n=document.getElementById("sidebarOverlay"),a=document.getElementById("closeSidebarBtn"),o=document.getElementById("sidebarSettingsBtn"),d=document.getElementById("settingsModal");function s(l){!t||!n||(l?(t.classList.remove("-translate-x-full"),n.classList.remove("hidden"),setTimeout(()=>n.classList.remove("opacity-0"),10)):(t.classList.add("-translate-x-full"),n.classList.add("opacity-0"),setTimeout(()=>n.classList.add("hidden"),300)))}e&&e.addEventListener("click",l=>{l.stopPropagation(),s(!0)}),a&&a.addEventListener("click",()=>s(!1)),n&&n.addEventListener("click",()=>s(!1)),o&&d&&o.addEventListener("click",()=>{s(!1),d.classList.remove("hidden"),d.classList.add("flex");const l=document.getElementById("setBtnAccount");l&&l.click()})}function re(){const e=document.getElementById("profileDropdownBtn"),t=document.getElementById("profileDropdownMenu"),n=document.getElementById("closeDropdownBtn"),a=document.getElementById("menuSignOutBtn"),o=document.getElementById("dropdownSettingsBtn"),d=document.getElementById("settingsModal");e&&t&&(e.addEventListener("click",s=>{s.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",s=>{!e.contains(s.target)&&!t.contains(s.target)&&t.classList.add("hidden")})),n&&t&&n.addEventListener("click",s=>{s.stopPropagation(),t.classList.add("hidden")}),a&&a.addEventListener("click",async s=>{s.stopPropagation(),await X(),window.location.href="/pages/login/"}),o&&d&&o.addEventListener("click",()=>{t.classList.add("hidden"),d.classList.remove("hidden"),d.classList.add("flex");const s=document.getElementById("setBtnAccount");s&&s.click()})}function me(e){const t=document.getElementById("navProfileImg"),n=document.getElementById("navProfileIcon"),a=document.getElementById("menuProfileImg"),o=document.getElementById("menuProfileIcon"),d=document.getElementById("menuUserName"),s=document.getElementById("menuUserEmail");s&&(s.innerText=e.email);const l=p.settings||{};d&&(d.innerText=l.userFirstName?l.userFirstName:e.displayName?e.displayName.split(" ")[0]:"Student");const i=l.userProfileImage;if(i?(t&&(t.src=i,t.classList.remove("hidden")),n&&n.classList.add("hidden"),a&&(a.src=i,a.classList.remove("hidden")),o&&o.classList.add("hidden")):(t&&t.classList.add("hidden"),n&&n.classList.remove("hidden"),a&&a.classList.add("hidden"),o&&o.classList.remove("hidden")),l.showSplitBill==="true"){const g=document.getElementById("splitBillContainer");g&&g.classList.remove("hidden")}}window.handleSplitBillToggle=function(e){const t=document.getElementById("splitBillContainer");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))};
