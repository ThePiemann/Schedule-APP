import{o as q,b as J,l as R}from"./auth-cbFyKSDW.js";import{setCurrentUser as z,loadUserData as K,userData as g,saveUserData as Q}from"./store-C3fFsaMo.js";document.addEventListener("DOMContentLoaded",()=>{q(J,e=>{e?(z(e),K(()=>{V(e)})):window.location.href="/pages/login/"}),ae(),de(),te(),ne()});let p=[],x=[],E=[],B=[],w=null;function V(e){oe(e),g.finance||(g.finance={transactions:[],subscriptions:[],debts:[],goals:[]}),p=g.finance.transactions||[],x=g.finance.subscriptions||[],E=g.finance.debts||[],B=g.finance.goals||[],y()}function b(){g.finance={transactions:p,subscriptions:x,debts:E,goals:B},Q(),localStorage.setItem("studentDash_finance",JSON.stringify(g.finance))}const j=localStorage.getItem("studentDash_finance");j&&JSON.parse(j);function y(){W(),X(),Y(),Z(),ee()}function W(){const e=document.getElementById("totalBalanceDisplay"),t=document.getElementById("monthlySpentDisplay"),n=document.getElementById("recurringTotalDisplay"),a=document.getElementById("budgetProgressBar");let o=0,d=0,s=0;const i=new Date().getMonth();p.forEach(v=>{const I=parseFloat(v.amount);v.type==="income"?o+=I:(d+=I,new Date(v.date).getMonth()===i&&(s+=I))});const c=o-d;e.innerText=u(c),t.innerText=u(s);let h=0;x.forEach(v=>h+=parseFloat(v.cost)),n.innerText=u(h);const f=Math.min(s/500*100,100);a.style.width=`${f}%`,c<0?e.classList.add("text-red-500"):e.classList.remove("text-red-500")}function X(){const e=document.getElementById("transactionList");if(e.innerHTML="",p.length===0){e.innerHTML=`
            <div class="text-center py-10 opacity-50">
                <span class="material-symbols-outlined text-4xl mb-2">receipt_long</span>
                <p class="text-sm font-bold">No transactions yet.</p>
            </div>`;return}[...p].sort((n,a)=>new Date(a.date)-new Date(n.date)).forEach(n=>{const a=document.createElement("div");a.className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700 transition group";const o=n.type==="expense",d=se(n.category),s=o?"text-red-500":"text-green-500",l=o?"-":"+";a.innerHTML=`
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full ${o?"bg-red-100 text-red-500":"bg-green-100 text-green-500"} flex items-center justify-center">
                    <span class="material-symbols-outlined text-xl">${d}</span>
                </div>
                <div>
                    <h4 class="text-sm font-bold text-gray-800 dark:text-white">${n.description}</h4>
                    <p class="text-[10px] text-gray-500 font-medium">${new Date(n.date).toLocaleDateString()}</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span class="font-bold ${s}">${l}${u(n.amount)}</span>
                <button class="delete-trans-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${n.id}" title="Delete Transaction">
                    <span class="material-symbols-outlined text-lg">delete</span>
                </button>
            </div>
        `,e.appendChild(a)}),document.querySelectorAll(".delete-trans-btn").forEach(n=>{n.addEventListener("click",a=>{$(()=>{const o=parseInt(n.dataset.id);p=p.filter(d=>d.id!==o),b(),y()})})})}function Y(){const e=document.getElementById("subscriptionList");if(e.innerHTML="",x.length===0){e.innerHTML='<p class="text-xs text-gray-400 text-center py-4">No subscriptions added.</p>';return}x.forEach(t=>{const n=document.createElement("div");n.className="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded border border-gray-100 dark:border-gray-700/50 group",n.innerHTML=`
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                    <span class="text-xs font-bold text-gray-600 dark:text-gray-300">${t.name.charAt(0)}</span>
                </div>
                <div>
                    <p class="text-xs font-bold text-gray-800 dark:text-gray-200">${t.name}</p>
                    <p class="text-[10px] text-gray-400">Due day ${t.day}</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-xs font-bold text-gray-700 dark:text-gray-300">${u(t.cost)}</span>
                <button class="delete-sub-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${t.id}" title="Delete Subscription">
                    <span class="material-symbols-outlined text-lg">delete</span>
                </button>
            </div>
        `,e.appendChild(n)}),document.querySelectorAll(".delete-sub-btn").forEach(t=>{t.addEventListener("click",n=>{$(()=>{const a=parseInt(t.dataset.id);x=x.filter(o=>o.id!==a),b(),y()})})})}function Z(){const e=document.getElementById("debtList"),t=document.getElementById("totalOweDisplay"),n=document.getElementById("totalOwedDisplay");e.innerHTML="";let a=0,o=0;E.length===0?e.innerHTML='<p class="text-xs text-gray-400 text-center py-2">No debts recorded.</p>':(E.forEach(d=>{const s=parseFloat(d.amount);d.type==="owe_them"?a+=s:o+=s;const l=document.createElement("div");l.className="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded border border-gray-100 dark:border-gray-700/50 group";const i=d.type==="owe_them",c=i?"text-red-500":"text-green-500",h=i?"arrow_outward":"south_west";l.innerHTML=`
                <div class="flex items-center gap-2 overflow-hidden">
                    <div class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-700 flex items-center justify-center shrink-0">
                        <span class="material-symbols-outlined text-sm ${c}">${h}</span>
                    </div>
                    <div class="truncate">
                        <p class="text-xs font-bold text-gray-800 dark:text-gray-200 truncate">${d.person}</p>
                        <p class="text-[10px] text-gray-400 truncate">${d.description||"Debt"}</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs font-bold ${c}">${u(s)}</span>
                    <button class="delete-debt-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${d.id}">
                        <span class="material-symbols-outlined text-lg">delete</span>
                    </button>
                </div>
            `,e.appendChild(l)}),document.querySelectorAll(".delete-debt-btn").forEach(d=>{d.addEventListener("click",s=>{$(()=>{const l=parseInt(d.dataset.id);E=E.filter(i=>i.id!==l),b(),y()})})})),t.innerText=u(a),n.innerText=u(o)}function ee(){const e=document.getElementById("goalsList");if(e.innerHTML="",B.length===0){e.innerHTML='<p class="text-xs text-gray-400 text-center py-2">No goals set.</p>';return}let t=0;p.forEach(n=>{const a=parseFloat(n.amount);n.type==="income"?t+=a:t-=a}),B.forEach(n=>{const a=parseFloat(n.target),o=Math.min(t/a*100,100),d=t>=a,s=document.createElement("div");s.className="group",s.innerHTML=`
            <div class="flex justify-between items-end mb-1">
                <h4 class="text-sm font-bold text-gray-700 dark:text-gray-300">${n.name}</h4>
                <div class="flex items-center gap-2">
                    <span class="text-xs font-bold ${d?"text-green-500":"text-gray-500"}">
                        ${d?"Affordable!":`${Math.floor(o)}%`}
                    </span>
                    <button class="delete-goal-btn opacity-0 group-hover:opacity-100 transition text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1.5 rounded-full" data-id="${n.id}">
                        <span class="material-symbols-outlined text-lg">delete</span>
                    </button>
                </div>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 h-2 rounded-full overflow-hidden">
                <div class="h-full rounded-full transition-all duration-500 ${d?"bg-green-500":"bg-primary"}" style="width: ${Math.max(0,o)}%"></div>
            </div>
            <p class="text-[10px] text-gray-400 mt-1 text-right">${u(a)} Target</p>
        `,e.appendChild(s)}),document.querySelectorAll(".delete-goal-btn").forEach(n=>{n.addEventListener("click",()=>{$(()=>{const a=parseInt(n.dataset.id);B=B.filter(o=>o.id!==a),b(),y()})})})}function te(){const e=document.getElementById("transactionModal"),t=document.getElementById("addTransactionBtn"),n=document.getElementById("cancelTransBtn"),a=document.getElementById("saveTransBtn"),o=document.getElementById("subModal"),d=document.getElementById("addSubBtn"),s=document.getElementById("cancelSubBtn"),l=document.getElementById("saveSubBtn"),i=document.getElementById("debtModal"),c=document.getElementById("addDebtBtn"),h=document.getElementById("cancelDebtBtn"),N=document.getElementById("saveDebtBtn"),f=document.getElementById("goalModal"),v=document.getElementById("addGoalBtn"),I=document.getElementById("cancelGoalBtn"),F=document.getElementById("saveGoalBtn"),k=document.getElementById("typeOweThemBtn"),D=document.getElementById("typeOweMeBtn"),O=document.getElementById("debtTypeInput");c&&c.addEventListener("click",()=>{i.classList.remove("hidden"),i.classList.add("flex")}),h&&h.addEventListener("click",()=>{i.classList.add("hidden"),i.classList.remove("flex")}),k&&k.addEventListener("click",()=>{O.value="owe_them",k.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-red-500 transition",D.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition"}),D&&D.addEventListener("click",()=>{O.value="owe_me",D.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-green-500 transition",k.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition"}),N&&N.addEventListener("click",()=>{const r=document.getElementById("debtPersonInput").value,m=document.getElementById("debtAmountInput").value,L=document.getElementById("debtDescInput").value,P=O.value;if(!r||!m)return alert("Please fill in person and amount");E.push({id:Date.now(),person:r,amount:parseFloat(m),description:L,type:P,date:new Date().toISOString()}),b(),y(),document.getElementById("debtPersonInput").value="",document.getElementById("debtAmountInput").value="",document.getElementById("debtDescInput").value="",i.classList.add("hidden"),i.classList.remove("flex")}),v&&v.addEventListener("click",()=>{f.classList.remove("hidden"),f.classList.add("flex")}),I&&I.addEventListener("click",()=>{f.classList.add("hidden"),f.classList.remove("flex")}),F&&F.addEventListener("click",()=>{const r=document.getElementById("goalNameInput").value,m=document.getElementById("goalTargetInput").value;!r||!m||(B.push({id:Date.now(),name:r,target:parseFloat(m)}),b(),y(),document.getElementById("goalNameInput").value="",document.getElementById("goalTargetInput").value="",f.classList.add("hidden"),f.classList.remove("flex"))});const T=document.getElementById("deleteModal"),H=document.getElementById("confirmDeleteBtn"),_=document.getElementById("cancelDeleteBtn");H&&H.addEventListener("click",()=>{w&&w(),T.classList.add("hidden"),T.classList.remove("flex"),w=null}),_&&_.addEventListener("click",()=>{T.classList.add("hidden"),T.classList.remove("flex"),w=null});const S=document.getElementById("typeExpenseBtn"),M=document.getElementById("typeIncomeBtn"),C=document.getElementById("transTypeInput"),U=document.getElementById("transCategoryInput");t&&t.addEventListener("click",()=>{A("expense"),e.classList.remove("hidden"),e.classList.add("flex")}),n&&n.addEventListener("click",()=>{e.classList.add("hidden"),e.classList.remove("flex")}),S&&S.addEventListener("click",()=>{C.value="expense",S.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-red-500 transition",M.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition",A("expense")}),M&&M.addEventListener("click",()=>{C.value="income",M.className="flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-gray-600 text-green-500 transition",S.className="flex-1 py-1.5 text-xs font-bold rounded text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition",A("income")}),a&&a.addEventListener("click",()=>{const r=document.getElementById("transAmountInput").value,m=document.getElementById("transDescInput").value,L=U.value,P=C.value;if(!r||!m)return alert("Please fill in amount and description");const G={id:Date.now(),type:P,amount:parseFloat(r),category:L,description:m,date:new Date().toISOString()};p.unshift(G),b(),y(),document.getElementById("transAmountInput").value="",document.getElementById("transDescInput").value="",e.classList.add("hidden"),e.classList.remove("flex")}),d&&d.addEventListener("click",()=>{o.classList.remove("hidden"),o.classList.add("flex")}),s&&s.addEventListener("click",()=>{o.classList.add("hidden"),o.classList.remove("flex")}),l&&l.addEventListener("click",()=>{const r=document.getElementById("subNameInput").value,m=document.getElementById("subCostInput").value,L=document.getElementById("subDayInput").value;!r||!m||!L||(x.push({id:Date.now(),name:r,cost:parseFloat(m),day:parseInt(L)}),b(),y(),document.getElementById("subNameInput").value="",document.getElementById("subCostInput").value="",document.getElementById("subDayInput").value="",o.classList.add("hidden"),o.classList.remove("flex"))})}function A(e){const t=document.getElementById("transCategoryInput");t.innerHTML="",(e==="expense"?[{val:"food",label:"Food & Dining"},{val:"transport",label:"Transportation"},{val:"school",label:"School Supplies"},{val:"entertainment",label:"Entertainment"},{val:"shopping",label:"Shopping"},{val:"other",label:"Other"}]:[{val:"allowance",label:"Allowance"},{val:"job",label:"Part-time Job"},{val:"aid",label:"Financial Aid"},{val:"other",label:"Other"}]).forEach(d=>{const s=document.createElement("option");s.value=d.val,s.innerText=d.label,t.appendChild(s)})}function ne(){const e=document.getElementById("splitTotal"),t=document.getElementById("splitPeople"),n=document.getElementById("splitResult");function a(){const o=parseFloat(e.value)||0,d=parseInt(t.value)||1;if(d<1)return;const s=o/d;n.innerText=u(s)}e&&t&&(e.addEventListener("input",a),t.addEventListener("input",a))}function $(e){w=e;const t=document.getElementById("deleteModal");t.classList.remove("hidden"),t.classList.add("flex")}function u(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}function se(e){return{food:"fastfood",transport:"directions_bus",school:"school",entertainment:"movie",shopping:"shopping_bag",allowance:"savings",job:"work",aid:"volunteer_activism",other:"category"}[e]||"category"}function ae(){const e=document.getElementById("hamburgerBtn"),t=document.getElementById("appSidebar"),n=document.getElementById("sidebarOverlay"),a=document.getElementById("closeSidebarBtn"),o=document.getElementById("sidebarSettingsBtn"),d=document.getElementById("settingsModal");function s(l){!t||!n||(l?(t.classList.remove("-translate-x-full"),n.classList.remove("hidden"),setTimeout(()=>n.classList.remove("opacity-0"),10)):(t.classList.add("-translate-x-full"),n.classList.add("opacity-0"),setTimeout(()=>n.classList.add("hidden"),300)))}e&&e.addEventListener("click",l=>{l.stopPropagation(),s(!0)}),a&&a.addEventListener("click",()=>s(!1)),n&&n.addEventListener("click",()=>s(!1)),o&&d&&o.addEventListener("click",()=>{s(!1),d.classList.remove("hidden"),d.classList.add("flex");const l=document.getElementById("setBtnAccount");l&&l.click()})}function de(){const e=document.getElementById("profileDropdownBtn"),t=document.getElementById("profileDropdownMenu"),n=document.getElementById("closeDropdownBtn"),a=document.getElementById("menuSignOutBtn"),o=document.getElementById("dropdownSettingsBtn"),d=document.getElementById("settingsModal");e&&t&&(e.addEventListener("click",s=>{s.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",s=>{!e.contains(s.target)&&!t.contains(s.target)&&t.classList.add("hidden")})),n&&t&&n.addEventListener("click",s=>{s.stopPropagation(),t.classList.add("hidden")}),a&&a.addEventListener("click",async s=>{s.stopPropagation(),await R(),window.location.href="/pages/login/"}),o&&d&&o.addEventListener("click",()=>{t.classList.add("hidden"),d.classList.remove("hidden"),d.classList.add("flex");const s=document.getElementById("setBtnAccount");s&&s.click()})}function oe(e){const t=document.getElementById("navProfileImg"),n=document.getElementById("navProfileIcon"),a=document.getElementById("menuProfileImg"),o=document.getElementById("menuProfileIcon"),d=document.getElementById("menuUserName"),s=document.getElementById("menuUserEmail");s&&(s.innerText=e.email);const l=g.settings||{};d&&(d.innerText=l.userFirstName?l.userFirstName:e.displayName||"Student");const i=l.userProfileImage;if(i?(t&&(t.src=i,t.classList.remove("hidden")),n&&n.classList.add("hidden"),a&&(a.src=i,a.classList.remove("hidden")),o&&o.classList.add("hidden")):(t&&t.classList.add("hidden"),n&&n.classList.remove("hidden"),a&&a.classList.add("hidden"),o&&o.classList.remove("hidden")),l.showSplitBill==="true"){const c=document.getElementById("splitBillContainer");c&&c.classList.remove("hidden")}}window.handleSplitBillToggle=function(e){const t=document.getElementById("splitBillContainer");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))};
